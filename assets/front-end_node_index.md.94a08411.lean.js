import{o as n,c as s,a,d as t,e as o}from"./app.4f4649a6.js";const e='{"title":"什么是 koa？","description":"","frontmatter":{},"headers":[{"level":2,"title":"什么是 koa？","slug":"什么是-koa？"},{"level":2,"title":"核心概念","slug":"核心概念"},{"level":2,"title":"初识 koa","slug":"初识-koa"},{"level":2,"title":"路由&中间件","slug":"路由-中间件"},{"level":3,"title":"安装依赖：@koa/router","slug":"安装依赖：-koa-router"},{"level":3,"title":"定义路由","slug":"定义路由"},{"level":3,"title":"中间件","slug":"中间件"},{"level":2,"title":"常见获取值的几种方式","slug":"常见获取值的几种方式"},{"level":2,"title":"创建 RESTful 接口","slug":"创建-restful-接口"}],"relativePath":"front-end/node/index.md","lastUpdated":1627482582841}',c={},p=t("h2",{id:"什么是-koa？"},[t("a",{class:"header-anchor",href:"#什么是-koa？","aria-hidden":"true"},"#"),o(" 什么是 koa？")],-1),l=t("p",null,[t("a",{href:"https://koajs.com/",target:"_blank",rel:"noopener noreferrer"},"koa"),o(" ("),t("a",{href:"https://www.koajs.com.cn/",target:"_blank",rel:"noopener noreferrer"},"中文网"),o(")是基于 Node.js 平台的下一代 web 开发框架，致力于成为应用和 API 开发领域中的一个更小、更富有表现力、更健壮的基石；利用"),t("em",null,"async 函数"),o("丢弃回调函数，并增强错误处理，koa 没有任何预置的中间件，可快速的编写服务端应用程序。")],-1),u=t("h2",{id:"核心概念"},[t("a",{class:"header-anchor",href:"#核心概念","aria-hidden":"true"},"#"),o(" 核心概念")],-1),k=t("ul",null,[t("li",null,"Koa Application（应用程序）"),t("li",null,"Context（上下文）"),t("li",null,"Request（请求）、Response(响应)")],-1),i=t("h2",{id:"初识-koa"},[t("a",{class:"header-anchor",href:"#初识-koa","aria-hidden":"true"},"#"),o(" 初识 koa")],-1),r=t("div",{class:"language-shell"},[t("pre",null,[t("code",null,[o("// 创建一个 acquaintance 的文件夹\n$ "),t("span",{class:"token function"},"mkdir"),o(" acquaintance\n\n// 进入创建的文件夹\n$ "),t("span",{class:"token builtin class-name"},"cd"),o(" acquaintance\n\n// 初始化 package.json\n$ "),t("span",{class:"token function"},"npm"),o(" init -y\n\n// 安装 koa，安装完之后\n$ "),t("span",{class:"token function"},"npm"),o(" i koa\n")])])],-1),d=t("div",{class:"tip custom-block"},[t("p",{class:"custom-block-title"},"TIP"),t("p",null,"可以在 package.json 中查看安装的所有依赖")],-1),m=t("p",null,"在工程目录里创建一个 app.js，代码如下：",-1),g=t("div",{class:"language-javascript"},[t("pre",null,[t("code",null,[t("span",{class:"token keyword"},"const"),o(" Koa "),t("span",{class:"token operator"},"="),o(),t("span",{class:"token function"},"require"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'koa'"),t("span",{class:"token punctuation"},")"),o(),t("span",{class:"token comment"},"// 引入koa"),o("\n"),t("span",{class:"token keyword"},"const"),o(" app "),t("span",{class:"token operator"},"="),o(),t("span",{class:"token keyword"},"new"),o(),t("span",{class:"token class-name"},"Koa"),t("span",{class:"token punctuation"},"("),t("span",{class:"token punctuation"},")"),o(),t("span",{class:"token comment"},"// 实例化koa"),o("\n\napp"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"use"),t("span",{class:"token punctuation"},"("),t("span",{class:"token parameter"},"ctx"),o(),t("span",{class:"token operator"},"=>"),o(),t("span",{class:"token punctuation"},"{"),o("\n    ctx"),t("span",{class:"token punctuation"},"."),o("body "),t("span",{class:"token operator"},"="),o(),t("span",{class:"token string"},"'hi koa'"),o("\n"),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},")"),o("\n\n"),t("span",{class:"token comment"},"// 启动应用程序  参数：端口号"),o("\napp"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"listen"),t("span",{class:"token punctuation"},"("),t("span",{class:"token number"},"3003"),t("span",{class:"token punctuation"},")"),o("\n")])])],-1),f=t("p",null,[o("在终端中使用"),t("code",null,"node app.js"),o("命令（前提是终端中的路径必须指向所创建工程文件夹的路径） 打开浏览器访问："),t("code",null,"http://localhost:3003"),o(" 此时浏览器中就会输出"),t("code",null,"hi koa"),o("，如下图：")],-1),y=t("img",{src:"/assets/1.f566a842.png",style:{display:"block","box-shadow":"2px 1px 1px #d0c6c629"}},null,-1),h=t("div",{class:"warning custom-block"},[t("p",{class:"custom-block-title"},"WARNING"),t("p",null,"上面代码虽然轻松实现了一个 web 服务器，但是返回的数据和所请求都是固定的；并不适应真实的业务场景，比如：获取请求接口时的参数、方法、修改一次代码就要在终端中重新运行启动命令等；")],-1),w=t("p",null,[o("由于使用的"),t("code",null,"node app.js"),o("启动，所以每次更改都要重新启动，这样给我们开发带来了极大的不便利，所以我们可以使用一些第三方依赖来自动监听文件的变化并重新启动，开发环境可以使用"),t("code",null,"nodemon"),o(" 首先安装"),t("code",null,"npm i nodemon -D"),o("，也可以全局安装此依赖，生产环境的话可以使用"),t("code",null,"pm2"),o(" 安装之后在"),t("code",null,"package.json"),o("的"),t("code",null,"scripts"),o("中添加启动方式；如下")],-1),x=t("div",{class:"language-json"},[t("pre",null,[t("code",null,[t("span",{class:"token punctuation"},"{"),o("\n    "),t("span",{class:"token property"},'"name"'),t("span",{class:"token operator"},":"),o(),t("span",{class:"token string"},'"acquaintance"'),t("span",{class:"token punctuation"},","),o("\n    "),t("span",{class:"token property"},'"version"'),t("span",{class:"token operator"},":"),o(),t("span",{class:"token string"},'"1.0.0"'),t("span",{class:"token punctuation"},","),o("\n    "),t("span",{class:"token property"},'"description"'),t("span",{class:"token operator"},":"),o(),t("span",{class:"token string"},'""'),t("span",{class:"token punctuation"},","),o("\n    "),t("span",{class:"token property"},'"main"'),t("span",{class:"token operator"},":"),o(),t("span",{class:"token string"},'"index.js"'),t("span",{class:"token punctuation"},","),o("\n    "),t("span",{class:"token property"},'"scripts"'),t("span",{class:"token operator"},":"),o(),t("span",{class:"token punctuation"},"{"),o("\n        "),t("span",{class:"token property"},'"dev"'),t("span",{class:"token operator"},":"),o(),t("span",{class:"token string"},'"nodemon app.js"'),o("\n    "),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},","),o("\n    "),t("span",{class:"token property"},'"keywords"'),t("span",{class:"token operator"},":"),o(),t("span",{class:"token punctuation"},"["),t("span",{class:"token punctuation"},"]"),t("span",{class:"token punctuation"},","),o("\n    "),t("span",{class:"token property"},'"author"'),t("span",{class:"token operator"},":"),o(),t("span",{class:"token string"},'""'),t("span",{class:"token punctuation"},","),o("\n    "),t("span",{class:"token property"},'"license"'),t("span",{class:"token operator"},":"),o(),t("span",{class:"token string"},'"ISC"'),t("span",{class:"token punctuation"},","),o("\n    "),t("span",{class:"token property"},'"dependencies"'),t("span",{class:"token operator"},":"),o(),t("span",{class:"token punctuation"},"{"),o("\n        "),t("span",{class:"token property"},'"koa"'),t("span",{class:"token operator"},":"),o(),t("span",{class:"token string"},'"^2.13.1"'),o("\n    "),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},","),o("\n    "),t("span",{class:"token property"},'"devDependencies"'),t("span",{class:"token operator"},":"),o(),t("span",{class:"token punctuation"},"{"),o("\n        "),t("span",{class:"token property"},'"nodemon"'),t("span",{class:"token operator"},":"),o(),t("span",{class:"token string"},'"^2.0.7"'),o("\n    "),t("span",{class:"token punctuation"},"}"),o("\n"),t("span",{class:"token punctuation"},"}"),o("\n")])])],-1),b=t("p",null,[o("在终端中执行命令："),t("code",null,"npm run dev"),o(",这样就不用我们每次修改都重新启动，执行之后就会在终端中提示，如下： "),t("img",{src:"/assets/e59f418482657d4dd68a3543880292b.4dac7c38.png",alt:""})],-1),v=t("div",{class:"tip custom-block"},[t("p",{class:"custom-block-title"},"TIP"),t("p",null,"执行命令时，终端的路径必须指向当前程序")],-1),j=t("h2",{id:"路由-中间件"},[t("a",{class:"header-anchor",href:"#路由-中间件","aria-hidden":"true"},"#"),o(" 路由&中间件")],-1),q=t("h3",{id:"安装依赖：-koa-router"},[t("a",{class:"header-anchor",href:"#安装依赖：-koa-router","aria-hidden":"true"},"#"),o(" 安装依赖："),t("a",{href:"https://www.npmjs.com/package/@koa/router",target:"_blank",rel:"noopener noreferrer"},"@koa/router")],-1),R=t("div",{class:"language-git"},[t("pre",null,[t("code",null,"$ npm i @koa/router\n")])],-1),K=t("h3",{id:"定义路由"},[t("a",{class:"header-anchor",href:"#定义路由","aria-hidden":"true"},"#"),o(" 定义路由")],-1),P=t("ul",null,[t("li",null,[o("在 app.js 中引入"),t("code",null,"@koa/router"),o("，然后再实例化")])],-1),F=t("div",{class:"language-javascript"},[t("pre",null,[t("code",null,[t("span",{class:"token keyword"},"const"),o(" Router "),t("span",{class:"token operator"},"="),o(),t("span",{class:"token function"},"require"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'@koa/router'"),t("span",{class:"token punctuation"},")"),o("\n"),t("span",{class:"token keyword"},"const"),o(" router "),t("span",{class:"token operator"},"="),o(),t("span",{class:"token keyword"},"new"),o(),t("span",{class:"token class-name"},"Router"),t("span",{class:"token punctuation"},"("),t("span",{class:"token punctuation"},"{"),o(" prefix"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token string"},"'/api/v1'"),o(),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},")"),o(),t("span",{class:"token comment"},"// 实例化的时候可以自定义一个接口前缀"),o("\n")])])],-1),M=t("ul",null,[t("li",null,"注册 router")],-1),S=t("div",{class:"language-javascript"},[t("pre",null,[t("code",null,[o("app"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"use"),t("span",{class:"token punctuation"},"("),o("router"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"routes"),t("span",{class:"token punctuation"},"("),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"use"),t("span",{class:"token punctuation"},"("),o("router"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"allowedMethods"),t("span",{class:"token punctuation"},"("),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},")"),o("\n")])])],-1),T=t("ul",null,[t("li",null,"定义接口")],-1),A=t("div",{class:"language-javascript"},[t("pre",null,[t("code",null,[o("router"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"get"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'/'"),t("span",{class:"token punctuation"},","),o(),t("span",{class:"token keyword"},"async"),o(),t("span",{class:"token parameter"},"ctx"),o(),t("span",{class:"token operator"},"=>"),o(),t("span",{class:"token punctuation"},"{"),o("\n    ctx"),t("span",{class:"token punctuation"},"."),o("body "),t("span",{class:"token operator"},"="),o(),t("span",{class:"token punctuation"},"{"),o("\n        status"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token number"},"200"),t("span",{class:"token punctuation"},","),o("\n        message"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token string"},"'hi @koa/router'"),o("\n    "),t("span",{class:"token punctuation"},"}"),o("\n"),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},")"),o("\n\nrouter"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"get"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'/user'"),t("span",{class:"token punctuation"},","),o(),t("span",{class:"token keyword"},"async"),o(),t("span",{class:"token parameter"},"ctx"),o(),t("span",{class:"token operator"},"=>"),o(),t("span",{class:"token punctuation"},"{"),o("\n    ctx"),t("span",{class:"token punctuation"},"."),o("body "),t("span",{class:"token operator"},"="),o(),t("span",{class:"token punctuation"},"{"),o("\n        status"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token number"},"200"),t("span",{class:"token punctuation"},","),o("\n        message"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token string"},"'success'"),t("span",{class:"token punctuation"},","),o("\n        data"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token punctuation"},"{"),o("\n            nickname"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token string"},"'Forest'"),t("span",{class:"token punctuation"},","),o("\n            age"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token number"},"18"),t("span",{class:"token punctuation"},","),o("\n            jobs"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token string"},"'前端攻城狮'"),t("span",{class:"token punctuation"},","),o("\n            skills"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token string"},"'搬砖'"),o("\n        "),t("span",{class:"token punctuation"},"}"),o("\n    "),t("span",{class:"token punctuation"},"}"),o("\n"),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},")"),o("\n")])])],-1),C=t("p",null,"完整代码如下：",-1),I=t("div",{class:"language-javascript"},[t("pre",null,[t("code",null,[t("span",{class:"token keyword"},"const"),o(" Koa "),t("span",{class:"token operator"},"="),o(),t("span",{class:"token function"},"require"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'koa'"),t("span",{class:"token punctuation"},")"),o("\n"),t("span",{class:"token keyword"},"const"),o(" Router "),t("span",{class:"token operator"},"="),o(),t("span",{class:"token function"},"require"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'@koa/router'"),t("span",{class:"token punctuation"},")"),o("\n"),t("span",{class:"token keyword"},"const"),o(" app "),t("span",{class:"token operator"},"="),o(),t("span",{class:"token keyword"},"new"),o(),t("span",{class:"token class-name"},"Koa"),t("span",{class:"token punctuation"},"("),t("span",{class:"token punctuation"},")"),o("\n"),t("span",{class:"token keyword"},"const"),o(" router "),t("span",{class:"token operator"},"="),o(),t("span",{class:"token keyword"},"new"),o(),t("span",{class:"token class-name"},"Router"),t("span",{class:"token punctuation"},"("),t("span",{class:"token punctuation"},"{"),o(" prefix"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token string"},"'/api/v1'"),o(),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},")"),o(),t("span",{class:"token comment"},"// 添加接口前缀"),o("\n\nrouter"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"get"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'/'"),t("span",{class:"token punctuation"},","),o(),t("span",{class:"token keyword"},"async"),o(),t("span",{class:"token parameter"},"ctx"),o(),t("span",{class:"token operator"},"=>"),o(),t("span",{class:"token punctuation"},"{"),o("\n    ctx"),t("span",{class:"token punctuation"},"."),o("body "),t("span",{class:"token operator"},"="),o(),t("span",{class:"token punctuation"},"{"),o("\n        status"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token number"},"200"),t("span",{class:"token punctuation"},","),o("\n        message"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token string"},"'hi @koa/router'"),o("\n    "),t("span",{class:"token punctuation"},"}"),o("\n"),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},")"),o("\n\nrouter"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"get"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'/user'"),t("span",{class:"token punctuation"},","),o(),t("span",{class:"token keyword"},"async"),o(),t("span",{class:"token parameter"},"ctx"),o(),t("span",{class:"token operator"},"=>"),o(),t("span",{class:"token punctuation"},"{"),o("\n    ctx"),t("span",{class:"token punctuation"},"."),o("body "),t("span",{class:"token operator"},"="),o(),t("span",{class:"token punctuation"},"{"),o("\n        status"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token number"},"200"),t("span",{class:"token punctuation"},","),o("\n        message"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token string"},"'success'"),t("span",{class:"token punctuation"},","),o("\n        data"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token punctuation"},"{"),o("\n            nickname"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token string"},"'Forest'"),t("span",{class:"token punctuation"},","),o("\n            age"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token number"},"18"),t("span",{class:"token punctuation"},","),o("\n            jobs"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token string"},"'前端攻城狮'"),t("span",{class:"token punctuation"},","),o("\n            skills"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token string"},"'搬砖'"),o("\n        "),t("span",{class:"token punctuation"},"}"),o("\n    "),t("span",{class:"token punctuation"},"}"),o("\n"),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},")"),o("\n\napp"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"use"),t("span",{class:"token punctuation"},"("),o("router"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"routes"),t("span",{class:"token punctuation"},"("),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"use"),t("span",{class:"token punctuation"},"("),o("router"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"allowedMethods"),t("span",{class:"token punctuation"},"("),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},")"),o("\n"),t("span",{class:"token comment"},"// 启动应用程序  参数：端口号"),o("\napp"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"listen"),t("span",{class:"token punctuation"},"("),t("span",{class:"token number"},"3003"),t("span",{class:"token punctuation"},")"),o("\n")])])],-1),N=t("p",null,[o("在浏览器中请求："),t("code",null,"http://localhost:3003/api/v1"),o("、"),t("code",null,"http://localhost:3003/api/v1/user"),o("，结果如下图："),t("br"),t("img",{src:"/assets/218479d47f383ef974d2fda8adceb32.dbbad8f5.png",style:{"box-shadow":"2px 1px 1px #d0c6c629","vertical-align":"top","margin-top":"10px"}}),t("img",{src:"/assets/2b6d9070e5014f6bfd01b61adec5d93.5d789ec2.png",style:{"box-shadow":"2px 1px 1px #d0c6c629","vertical-align":"top","margin-top":"10px"}})],-1),$=t("h3",{id:"中间件"},[t("a",{class:"header-anchor",href:"#中间件","aria-hidden":"true"},"#"),o(" 中间件")],-1),D=t("p",null,[o("中间件其实就是一个个函数，通过"),t("code",null,"app.use()"),o("注册；在 koa 中只会自动执行第一个中间件，后面的都需要我们自己调用，koa 在执行中间件的时候都会携带两个参数"),t("code",null,"context"),o("(可简化为"),t("code",null,"ctx"),o(")和"),t("code",null,"next"),o("，"),t("code",null,"context"),o("是 koa 的上下文对象，"),t("code",null,"next"),o("就是下一个中间件函数;也就是洋葱模型；所谓洋葱模型，就是指每一个 Koa 中间件都是一层洋葱圈，它即可以掌管请求进入，也可以掌管响应返回。换句话说：外层的中间件可以影响内层的请求和响应阶段，内层的中间件只能影响外层的响应阶段。 "),t("img",{src:"/assets/85988383413dec71e0d17d991ac8a5a.d2b71f1c.png",style:{display:"block","box-shadow":"2px 1px 1px #d0c6c629"}}),o(" 执行顺序按照 app.use()的顺序执行，中间件可以通过 await next()来执行下一个中间件，同时在最后一个中间件执行完成后，依然有恢复执行的能力。即，通过洋葱模型，await next()控制调用 “下游”中间件，直到 “下游”没有中间件且堆栈执行完毕，最终流回“上游”中间件。")],-1),E=t("p",null,"下面这段代码的结果就能很好的诠释，示例：",-1),_=t("div",{class:"language-javascript"},[t("pre",null,[t("code",null,[t("span",{class:"token keyword"},"const"),o(" Koa "),t("span",{class:"token operator"},"="),o(),t("span",{class:"token function"},"require"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'koa'"),t("span",{class:"token punctuation"},")"),o("\n"),t("span",{class:"token keyword"},"const"),o(" app "),t("span",{class:"token operator"},"="),o(),t("span",{class:"token keyword"},"new"),o(),t("span",{class:"token class-name"},"Koa"),t("span",{class:"token punctuation"},"("),t("span",{class:"token punctuation"},")"),o("\n\napp"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"use"),t("span",{class:"token punctuation"},"("),t("span",{class:"token keyword"},"async"),o(),t("span",{class:"token punctuation"},"("),t("span",{class:"token parameter"},[o("ctx"),t("span",{class:"token punctuation"},","),o(" next")]),t("span",{class:"token punctuation"},")"),o(),t("span",{class:"token operator"},"=>"),o(),t("span",{class:"token punctuation"},"{"),o("\n    console"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"log"),t("span",{class:"token punctuation"},"("),t("span",{class:"token template-string"},[t("span",{class:"token template-punctuation string"},"`"),t("span",{class:"token string"},"this is a middleware 1"),t("span",{class:"token template-punctuation string"},"`")]),t("span",{class:"token punctuation"},")"),o("\n    "),t("span",{class:"token keyword"},"await"),o(),t("span",{class:"token function"},"next"),t("span",{class:"token punctuation"},"("),t("span",{class:"token punctuation"},")"),o("\n    console"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"log"),t("span",{class:"token punctuation"},"("),t("span",{class:"token template-string"},[t("span",{class:"token template-punctuation string"},"`"),t("span",{class:"token string"},"this is a middleware 1 end "),t("span",{class:"token template-punctuation string"},"`")]),t("span",{class:"token punctuation"},")"),o("\n"),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},")"),o("\n\napp"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"use"),t("span",{class:"token punctuation"},"("),t("span",{class:"token keyword"},"async"),o(),t("span",{class:"token punctuation"},"("),t("span",{class:"token parameter"},[o("ctx"),t("span",{class:"token punctuation"},","),o(" next")]),t("span",{class:"token punctuation"},")"),o(),t("span",{class:"token operator"},"=>"),o(),t("span",{class:"token punctuation"},"{"),o("\n    console"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"log"),t("span",{class:"token punctuation"},"("),t("span",{class:"token template-string"},[t("span",{class:"token template-punctuation string"},"`"),t("span",{class:"token string"},"this is a middleware 2"),t("span",{class:"token template-punctuation string"},"`")]),t("span",{class:"token punctuation"},")"),o("\n    "),t("span",{class:"token keyword"},"await"),o(),t("span",{class:"token function"},"next"),t("span",{class:"token punctuation"},"("),t("span",{class:"token punctuation"},")"),o("\n    console"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"log"),t("span",{class:"token punctuation"},"("),t("span",{class:"token template-string"},[t("span",{class:"token template-punctuation string"},"`"),t("span",{class:"token string"},"this is a middleware 2 end "),t("span",{class:"token template-punctuation string"},"`")]),t("span",{class:"token punctuation"},")"),o("\n"),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},")"),o("\n\napp"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"use"),t("span",{class:"token punctuation"},"("),t("span",{class:"token keyword"},"async"),o(),t("span",{class:"token punctuation"},"("),t("span",{class:"token parameter"},[o("ctx"),t("span",{class:"token punctuation"},","),o(" next")]),t("span",{class:"token punctuation"},")"),o(),t("span",{class:"token operator"},"=>"),o(),t("span",{class:"token punctuation"},"{"),o("\n    console"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"log"),t("span",{class:"token punctuation"},"("),t("span",{class:"token template-string"},[t("span",{class:"token template-punctuation string"},"`"),t("span",{class:"token string"},"this is a middleware 3"),t("span",{class:"token template-punctuation string"},"`")]),t("span",{class:"token punctuation"},")"),o("\n    "),t("span",{class:"token keyword"},"await"),o(),t("span",{class:"token function"},"next"),t("span",{class:"token punctuation"},"("),t("span",{class:"token punctuation"},")"),o("\n    console"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"log"),t("span",{class:"token punctuation"},"("),t("span",{class:"token template-string"},[t("span",{class:"token template-punctuation string"},"`"),t("span",{class:"token string"},"this is a middleware 3 end "),t("span",{class:"token template-punctuation string"},"`")]),t("span",{class:"token punctuation"},")"),o("\n"),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},")"),o("\n\napp"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"listen"),t("span",{class:"token punctuation"},"("),t("span",{class:"token number"},"3004"),t("span",{class:"token punctuation"},")"),o("\n")])])],-1),B=t("p",null,"运行结果：",-1),G=t("div",{class:"language-base"},[t("pre",null,[t("code",null,"this is a middleware 1\nthis is a middleware 2\nthis is a middleware 3\nthis is a middleware 3 end\nthis is a middleware 2 end\nthis is a middleware 1 end\n")])],-1),H=t("h4",{id:"中间件是如何执行的？"},[t("a",{class:"header-anchor",href:"#中间件是如何执行的？","aria-hidden":"true"},"#"),o(" 中间件是如何执行的？")],-1),J=t("div",{class:"language-javascript"},[t("pre",null,[t("code",null,[t("span",{class:"token comment"},"// 通过 createServer 方法启动一个 Node.js 服务"),o("\n"),t("span",{class:"token function"},"listen"),t("span",{class:"token punctuation"},"("),t("span",{class:"token parameter"},[t("span",{class:"token operator"},"..."),o("args")]),t("span",{class:"token punctuation"},")"),o(),t("span",{class:"token punctuation"},"{"),o("\n    "),t("span",{class:"token keyword"},"const"),o(" server "),t("span",{class:"token operator"},"="),o(" http"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"createServer"),t("span",{class:"token punctuation"},"("),t("span",{class:"token keyword"},"this"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"callback"),t("span",{class:"token punctuation"},"("),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),o("\n    "),t("span",{class:"token keyword"},"return"),o(" server"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"listen"),t("span",{class:"token punctuation"},"("),t("span",{class:"token operator"},"..."),o("args"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),o("\n"),t("span",{class:"token punctuation"},"}"),o("\n")])])],-1),U=t("p",null,[o("Koa 框架通过 http 模块的 createServer 方法创建一个 Node.js 服务，并传入 "),t("code",null,"this.callback()"),o(" 方法， "),t("code",null,"this.callback()"),o(" 方法源码精简实现如下：")],-1),W=t("div",{class:"language-javascript"},[t("pre",null,[t("code",null,[t("span",{class:"token keyword"},"function"),o(),t("span",{class:"token function"},"compose"),t("span",{class:"token punctuation"},"("),t("span",{class:"token parameter"},"middleware"),t("span",{class:"token punctuation"},")"),o(),t("span",{class:"token punctuation"},"{"),o("\n    "),t("span",{class:"token comment"},"// 这里返回的函数，就是上文中的 fnMiddleware"),o("\n    "),t("span",{class:"token keyword"},"return"),o(),t("span",{class:"token keyword"},"function"),o(),t("span",{class:"token punctuation"},"("),t("span",{class:"token parameter"},[o("context"),t("span",{class:"token punctuation"},","),o(" next")]),t("span",{class:"token punctuation"},")"),o(),t("span",{class:"token punctuation"},"{"),o("\n        "),t("span",{class:"token keyword"},"let"),o(" index "),t("span",{class:"token operator"},"="),o(),t("span",{class:"token operator"},"-"),t("span",{class:"token number"},"1"),o("\n        "),t("span",{class:"token keyword"},"return"),o(),t("span",{class:"token function"},"dispatch"),t("span",{class:"token punctuation"},"("),t("span",{class:"token number"},"0"),t("span",{class:"token punctuation"},")"),o("\n\n        "),t("span",{class:"token keyword"},"function"),o(),t("span",{class:"token function"},"dispatch"),t("span",{class:"token punctuation"},"("),t("span",{class:"token parameter"},"i"),t("span",{class:"token punctuation"},")"),o(),t("span",{class:"token punctuation"},"{"),o("\n            "),t("span",{class:"token keyword"},"if"),o(),t("span",{class:"token punctuation"},"("),o("i "),t("span",{class:"token operator"},"<="),o(" index"),t("span",{class:"token punctuation"},")"),o(),t("span",{class:"token keyword"},"return"),o(" Promise"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"reject"),t("span",{class:"token punctuation"},"("),t("span",{class:"token keyword"},"new"),o(),t("span",{class:"token class-name"},"Error"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'next() called multiple times'"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},")"),o("\n            index "),t("span",{class:"token operator"},"="),o(" i\n            "),t("span",{class:"token comment"},"// 取出第 i 个中间件为 fn"),o("\n            "),t("span",{class:"token keyword"},"let"),o(" fn "),t("span",{class:"token operator"},"="),o(" middleware"),t("span",{class:"token punctuation"},"["),o("i"),t("span",{class:"token punctuation"},"]"),o("\n\n            "),t("span",{class:"token keyword"},"if"),o(),t("span",{class:"token punctuation"},"("),o("i "),t("span",{class:"token operator"},"==="),o(" middleware"),t("span",{class:"token punctuation"},"."),o("length"),t("span",{class:"token punctuation"},")"),o(" fn "),t("span",{class:"token operator"},"="),o(" next\n\n            "),t("span",{class:"token comment"},"// 已经取到了最后一个中间件，直接返回一个 Promise 实例，进行串联"),o("\n            "),t("span",{class:"token comment"},"// 这一步的意义是保证最后一个中间件调用 next 方法时，也不会报错"),o("\n            "),t("span",{class:"token keyword"},"if"),o(),t("span",{class:"token punctuation"},"("),t("span",{class:"token operator"},"!"),o("fn"),t("span",{class:"token punctuation"},")"),o(),t("span",{class:"token keyword"},"return"),o(" Promise"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"resolve"),t("span",{class:"token punctuation"},"("),t("span",{class:"token punctuation"},")"),o("\n\n            "),t("span",{class:"token keyword"},"try"),o(),t("span",{class:"token punctuation"},"{"),o("\n                "),t("span",{class:"token comment"},"// 把 ctx 和 next 方法传入到中间件 fn 中，并将执行结果使用 Promise.resolve 包装"),o("\n                "),t("span",{class:"token comment"},"// 这里可以发现，我们在一个中间件中调用的 next 方法，其实就是dispatch.bind(null, i + 1)，即调用下一个中间件"),o("\n                "),t("span",{class:"token keyword"},"return"),o(" Promise"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"resolve"),t("span",{class:"token punctuation"},"("),t("span",{class:"token function"},"fn"),t("span",{class:"token punctuation"},"("),o("context"),t("span",{class:"token punctuation"},","),o(),t("span",{class:"token function"},"dispatch"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"bind"),t("span",{class:"token punctuation"},"("),t("span",{class:"token keyword"},"null"),t("span",{class:"token punctuation"},","),o(" i "),t("span",{class:"token operator"},"+"),o(),t("span",{class:"token number"},"1"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),o("\n            "),t("span",{class:"token punctuation"},"}"),o(),t("span",{class:"token keyword"},"catch"),o(),t("span",{class:"token punctuation"},"("),o("err"),t("span",{class:"token punctuation"},")"),o(),t("span",{class:"token punctuation"},"{"),o("\n                "),t("span",{class:"token keyword"},"return"),o(" Promise"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"reject"),t("span",{class:"token punctuation"},"("),o("err"),t("span",{class:"token punctuation"},")"),o("\n            "),t("span",{class:"token punctuation"},"}"),o("\n        "),t("span",{class:"token punctuation"},"}"),o("\n    "),t("span",{class:"token punctuation"},"}"),o("\n"),t("span",{class:"token punctuation"},"}"),o("\n"),t("span",{class:"token function"},"callback"),t("span",{class:"token punctuation"},"("),t("span",{class:"token punctuation"},")"),o(),t("span",{class:"token punctuation"},"{"),o("\n    "),t("span",{class:"token comment"},"// 从 this.middleware 数组中，组合中间件"),o("\n    "),t("span",{class:"token keyword"},"const"),o(" fn "),t("span",{class:"token operator"},"="),o(),t("span",{class:"token function"},"compose"),t("span",{class:"token punctuation"},"("),t("span",{class:"token keyword"},"this"),t("span",{class:"token punctuation"},"."),o("middleware"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),o("\n\n    "),t("span",{class:"token comment"},"// handleRequest 方法作为 `http` 模块的 `createServer` 方法参数，"),o("\n    "),t("span",{class:"token comment"},"// 该方法通过 `createContext` 封装了 `http.createServer` 中的 `request` 和 `response`对象，并将这两个对象放到 ctx 中"),o("\n    "),t("span",{class:"token keyword"},"const"),o(),t("span",{class:"token function-variable function"},"handleRequest"),o(),t("span",{class:"token operator"},"="),o(),t("span",{class:"token punctuation"},"("),t("span",{class:"token parameter"},[o("req"),t("span",{class:"token punctuation"},","),o(" res")]),t("span",{class:"token punctuation"},")"),o(),t("span",{class:"token operator"},"=>"),o(),t("span",{class:"token punctuation"},"{"),o("\n        "),t("span",{class:"token keyword"},"const"),o(" ctx "),t("span",{class:"token operator"},"="),o(),t("span",{class:"token keyword"},"this"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"createContext"),t("span",{class:"token punctuation"},"("),o("req"),t("span",{class:"token punctuation"},","),o(" res"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),o("\n        "),t("span",{class:"token comment"},"// 将 ctx 和组合后的中间件函数 fn 传递给 this.handleRequest 方法"),o("\n        "),t("span",{class:"token keyword"},"return"),o(),t("span",{class:"token keyword"},"this"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"handleRequest"),t("span",{class:"token punctuation"},"("),o("ctx"),t("span",{class:"token punctuation"},","),o(" fn"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),o("\n    "),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},";"),o("\n\n    "),t("span",{class:"token keyword"},"return"),o(" handleRequest"),t("span",{class:"token punctuation"},";"),o("\n"),t("span",{class:"token punctuation"},"}"),o("\n"),t("span",{class:"token function"},"handleRequest"),t("span",{class:"token punctuation"},"("),t("span",{class:"token parameter"},[o("ctx"),t("span",{class:"token punctuation"},","),o(" fnMiddleware")]),t("span",{class:"token punctuation"},")"),o(),t("span",{class:"token punctuation"},"{"),o("\n    "),t("span",{class:"token keyword"},"const"),o(" res "),t("span",{class:"token operator"},"="),o(" ctx"),t("span",{class:"token punctuation"},"."),o("res"),t("span",{class:"token punctuation"},";"),o("\n    res"),t("span",{class:"token punctuation"},"."),o("statusCode "),t("span",{class:"token operator"},"="),o(),t("span",{class:"token number"},"404"),t("span",{class:"token punctuation"},";"),o("\n    "),t("span",{class:"token keyword"},"const"),o(),t("span",{class:"token function-variable function"},"onerror"),o(),t("span",{class:"token operator"},"="),o(),t("span",{class:"token parameter"},"err"),o(),t("span",{class:"token operator"},"=>"),o(" ctx"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"onerror"),t("span",{class:"token punctuation"},"("),o("err"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),o("\n    "),t("span",{class:"token keyword"},"const"),o(),t("span",{class:"token function-variable function"},"handleResponse"),o(),t("span",{class:"token operator"},"="),o(),t("span",{class:"token punctuation"},"("),t("span",{class:"token punctuation"},")"),o(),t("span",{class:"token operator"},"=>"),o(),t("span",{class:"token function"},"respond"),t("span",{class:"token punctuation"},"("),o("ctx"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),o("\n    "),t("span",{class:"token comment"},"// on-finished npm 包提供的方法，该方法在一个 HTTP 请求 closes，finishes 或者 errors 时执行"),o("\n    "),t("span",{class:"token function"},"onFinished"),t("span",{class:"token punctuation"},"("),o("res"),t("span",{class:"token punctuation"},","),o(" onerror"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),o("\n    "),t("span",{class:"token comment"},"// 将 ctx 对象传递给中间件函数 fnMiddleware"),o("\n    "),t("span",{class:"token keyword"},"return"),o(),t("span",{class:"token function"},"fnMiddleware"),t("span",{class:"token punctuation"},"("),o("ctx"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"then"),t("span",{class:"token punctuation"},"("),o("handleResponse"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"catch"),t("span",{class:"token punctuation"},"("),o("onerror"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),o("\n"),t("span",{class:"token punctuation"},"}"),o("\n")])])],-1),z=t("p",null,"将 Koa 一个中间件组合和执行流程梳理为以下步骤:",-1),L=t("ul",null,[t("li",null,"通过 compose 方法组合各种中间件，返回一个中间件组合函数 fnMiddleware"),t("li",null,"请求过来时，会先调用 handleRequest 方法，该方法完成："),t("li",null,"调用 createContext 方法，对该次请求封装出一个 ctx 对象；"),t("li",null,"接着调用 this.handleRequest(ctx, fnMiddleware)处理该次请求。"),t("li",null,"通过 fnMiddleware(ctx).then(handleResponse).catch(onerror)执行中间件。")],-1),O=t("h2",{id:"常见获取值的几种方式"},[t("a",{class:"header-anchor",href:"#常见获取值的几种方式","aria-hidden":"true"},"#"),o(" 常见获取值的几种方式")],-1),Q=t("ul",null,[t("li",null,[o("在 params 中取值，"),t("code",null,"eg：http://localhost:3003/api/v1/user/1")])],-1),V=t("div",{class:"language-javascript"},[t("pre",null,[t("code",null,[t("span",{class:"token comment"},"// 前端请求"),o("\n"),t("span",{class:"token keyword"},"await"),o(" axios"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"post"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'http://localhost:3003/api/v1/user/1'"),t("span",{class:"token punctuation"},")"),o("\n\n"),t("span",{class:"token comment"},"// 服务端"),o("\nrouter"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"post"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'/user/:id'"),t("span",{class:"token punctuation"},","),t("span",{class:"token keyword"},"async"),o(),t("span",{class:"token parameter"},"ctx"),o(),t("span",{class:"token operator"},"=>"),o(),t("span",{class:"token punctuation"},"{"),o("\n    "),t("span",{class:"token comment"},"//获取url的id"),o("\n    cosnt "),t("span",{class:"token punctuation"},"{"),o(" id "),t("span",{class:"token punctuation"},"}"),o(),t("span",{class:"token operator"},"="),o(" ctx"),t("span",{class:"token punctuation"},"."),o("params"),t("span",{class:"token punctuation"},";"),o(),t("span",{class:"token comment"},"// { id: 1 }"),o("\n"),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},")"),o("\n")])])],-1),X=t("ul",null,[t("li",null,"在 query 中取值，也就是获取问号后面的。")],-1),Y=t("div",{class:"language-JavaScript"},[t("pre",null,[t("code",null,[t("span",{class:"token comment"},"// 前端"),o("\n"),t("span",{class:"token keyword"},"await"),o(" axios"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"post"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'http://localhost:3003/api/v1/user?name=Forest&age=18'"),t("span",{class:"token punctuation"},")"),o("\n\n"),t("span",{class:"token comment"},"// 服务端"),o("\nrouter"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"post"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'/user'"),t("span",{class:"token punctuation"},","),o(),t("span",{class:"token keyword"},"async"),o(),t("span",{class:"token parameter"},"ctx"),o(),t("span",{class:"token operator"},"=>"),o(),t("span",{class:"token punctuation"},"{"),o("\n    "),t("span",{class:"token comment"},"//获取url的id"),o("\n    "),t("span",{class:"token keyword"},"const"),o(),t("span",{class:"token punctuation"},"{"),o(" name"),t("span",{class:"token punctuation"},","),o(" age "),t("span",{class:"token punctuation"},"}"),o(),t("span",{class:"token operator"},"="),o(" ctx"),t("span",{class:"token punctuation"},"."),o("request"),t("span",{class:"token punctuation"},"."),o("query "),t("span",{class:"token comment"},"// { name: Forest, age: 18 }"),o("\n"),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},")"),o("\n")])])],-1),Z=t("ul",null,[t("li",null,"获取 header 中的参数：")],-1),nn=t("div",{class:"language-javascript"},[t("pre",null,[t("code",null,[t("span",{class:"token comment"},"//请求接口时设置请求头"),o("\naxios\n    "),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"post"),t("span",{class:"token punctuation"},"("),o("\n        "),t("span",{class:"token string"},"'http://localhost/user?name=Forest&age=18'"),t("span",{class:"token punctuation"},","),o("\n        "),t("span",{class:"token punctuation"},"{"),o("\n            headers"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token punctuation"},"{"),o("\n                Author"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token string"},"'token'"),o("\n            "),t("span",{class:"token punctuation"},"}"),o("\n        "),t("span",{class:"token punctuation"},"}"),o("\n        "),t("span",{class:"token comment"},"//......"),o("\n    "),t("span",{class:"token punctuation"},")"),o("\n    "),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"then"),t("span",{class:"token punctuation"},"("),t("span",{class:"token parameter"},"res"),o(),t("span",{class:"token operator"},"=>"),o(" console"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"log"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'res:'"),t("span",{class:"token punctuation"},","),o(" res"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},")"),o("\n\n"),t("span",{class:"token comment"},"//在服务端获取则是："),o("\nrouter"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"post"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'/user'"),t("span",{class:"token punctuation"},","),o(),t("span",{class:"token keyword"},"async"),o(),t("span",{class:"token parameter"},"ctx"),o(),t("span",{class:"token operator"},"=>"),o(),t("span",{class:"token punctuation"},"{"),o("\n    "),t("span",{class:"token comment"},"//获取 url 的 id"),o("\n    "),t("span",{class:"token keyword"},"const"),o(),t("span",{class:"token punctuation"},"{"),o(" Author "),t("span",{class:"token punctuation"},"}"),o(),t("span",{class:"token operator"},"="),o(" ctx"),t("span",{class:"token punctuation"},"."),o("request"),t("span",{class:"token punctuation"},"."),o("header "),t("span",{class:"token comment"},"// { Author: 'token' }"),o("\n"),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},")"),o("\n")])])],-1),sn=t("ul",null,[t("li",null,[o("获取 body 中的数据，在服务端获取 body 中的一些数据只能用一些外部的插件；如："),t("code",null,"koa-body"),o("、"),t("code",null,"koa-bodyparser"),o(" 等等。 就以 "),t("code",null,"koa-body"),o(" 为例，首先安装 "),t("code",null,"npm i koa-body -S"),o("，再引入：")])],-1),an=t("div",{class:"language-javascript"},[t("pre",null,[t("code",null,[t("span",{class:"token comment"},"// 服务端"),o("\n"),t("span",{class:"token keyword"},"const"),o(" body "),t("span",{class:"token operator"},"="),o(),t("span",{class:"token function"},"require"),t("span",{class:"token punctuation"},"("),o("'koa"),t("span",{class:"token operator"},"-"),o("body"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),o("\n\n"),t("span",{class:"token comment"},"//然后在注册中间件："),o("\napp"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"use"),t("span",{class:"token punctuation"},"("),t("span",{class:"token function"},"body"),t("span",{class:"token punctuation"},"("),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),o("\n\n"),t("span",{class:"token comment"},"//在服务端获取则是："),o("\nrouter"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"post"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'/user'"),t("span",{class:"token punctuation"},","),o(),t("span",{class:"token keyword"},"async"),o(),t("span",{class:"token parameter"},"ctx"),o(),t("span",{class:"token operator"},"=>"),o(),t("span",{class:"token punctuation"},"{"),o("\n    "),t("span",{class:"token keyword"},"const"),o(" res "),t("span",{class:"token operator"},"="),o(" ctx"),t("span",{class:"token punctuation"},"."),o("request"),t("span",{class:"token punctuation"},"."),o("body"),t("span",{class:"token punctuation"},";"),o(),t("span",{class:"token comment"},"// { name: 'Foreset', age: 18 }"),o("\n"),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),o("\n\n\n"),t("span",{class:"token comment"},"//请求时有两种传参方式，一种是 json，另一种是 fromData；以 json 为例"),o("\naxios"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"post"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'http://localhost/user'"),t("span",{class:"token punctuation"},","),o(),t("span",{class:"token punctuation"},"{"),o("name"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token string"},"'Foreset'"),t("span",{class:"token punctuation"},","),o(" age"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token number"},"18"),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"then"),t("span",{class:"token punctuation"},"("),t("span",{class:"token parameter"},"res"),o(),t("span",{class:"token operator"},"=>"),o(),t("span",{class:"token punctuation"},"{"),o("\n    console"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"log"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'res:'"),t("span",{class:"token punctuation"},","),o(" res"),t("span",{class:"token punctuation"},")"),o("\n"),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),o("\n")])])],-1),tn=t("h2",{id:"创建-restful-接口"},[t("a",{class:"header-anchor",href:"#创建-restful-接口","aria-hidden":"true"},"#"),o(" 创建 RESTful 接口")],-1),on=t("div",{class:"language-javascript"},[t("pre",null,[t("code",null,[t("span",{class:"token keyword"},"const"),o(" Koa "),t("span",{class:"token operator"},"="),o(),t("span",{class:"token function"},"require"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'koa'"),t("span",{class:"token punctuation"},")"),o("\n"),t("span",{class:"token keyword"},"const"),o(" Router "),t("span",{class:"token operator"},"="),o(),t("span",{class:"token function"},"require"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'@koa/router'"),t("span",{class:"token punctuation"},")"),o("\n"),t("span",{class:"token keyword"},"const"),o(" koaBody "),t("span",{class:"token operator"},"="),o(),t("span",{class:"token function"},"require"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'koa-body'"),t("span",{class:"token punctuation"},")"),o("\n"),t("span",{class:"token keyword"},"const"),o(" app "),t("span",{class:"token operator"},"="),o(),t("span",{class:"token keyword"},"new"),o(),t("span",{class:"token class-name"},"Koa"),t("span",{class:"token punctuation"},"("),t("span",{class:"token punctuation"},")"),o("\n"),t("span",{class:"token keyword"},"const"),o(" router "),t("span",{class:"token operator"},"="),o(),t("span",{class:"token keyword"},"new"),o(),t("span",{class:"token class-name"},"Router"),t("span",{class:"token punctuation"},"("),t("span",{class:"token punctuation"},"{"),o(" prefix"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token string"},"'/api/v1'"),o(),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},")"),o("\n\nrouter"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"get"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'/'"),t("span",{class:"token punctuation"},","),o(),t("span",{class:"token keyword"},"async"),o(),t("span",{class:"token parameter"},"ctx"),o(),t("span",{class:"token operator"},"=>"),o(),t("span",{class:"token punctuation"},"{"),o("\n    ctx"),t("span",{class:"token punctuation"},"."),o("body "),t("span",{class:"token operator"},"="),o(),t("span",{class:"token punctuation"},"{"),o("\n        status"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token number"},"200"),t("span",{class:"token punctuation"},","),o("\n        message"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token string"},"'hi @koa/router'"),o("\n    "),t("span",{class:"token punctuation"},"}"),o("\n"),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},")"),o("\n\nrouter"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"get"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'/user'"),t("span",{class:"token punctuation"},","),o(),t("span",{class:"token keyword"},"async"),o(),t("span",{class:"token parameter"},"ctx"),o(),t("span",{class:"token operator"},"=>"),o(),t("span",{class:"token punctuation"},"{"),o("\n    ctx"),t("span",{class:"token punctuation"},"."),o("body "),t("span",{class:"token operator"},"="),o(),t("span",{class:"token punctuation"},"{"),o("\n        status"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token number"},"200"),t("span",{class:"token punctuation"},","),o("\n        message"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token string"},"'success'"),t("span",{class:"token punctuation"},","),o("\n        data"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token punctuation"},"{"),o("\n            query"),t("span",{class:"token operator"},":"),o(" ctx"),t("span",{class:"token punctuation"},"."),o("query"),t("span",{class:"token punctuation"},","),o("\n            nickname"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token string"},"'Forest'"),t("span",{class:"token punctuation"},","),o("\n            age"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token number"},"18"),t("span",{class:"token punctuation"},","),o("\n            jobs"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token string"},"'前端攻城狮'"),t("span",{class:"token punctuation"},","),o("\n            skills"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token string"},"'搬砖'"),o("\n        "),t("span",{class:"token punctuation"},"}"),o("\n    "),t("span",{class:"token punctuation"},"}"),o("\n"),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},")"),o("\n\nrouter"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"get"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'/user/:id'"),t("span",{class:"token punctuation"},","),o(),t("span",{class:"token keyword"},"async"),o(),t("span",{class:"token parameter"},"ctx"),o(),t("span",{class:"token operator"},"=>"),o(),t("span",{class:"token punctuation"},"{"),o("\n    "),t("span",{class:"token keyword"},"const"),o(),t("span",{class:"token punctuation"},"{"),o(" id "),t("span",{class:"token punctuation"},"}"),o(),t("span",{class:"token operator"},"="),o(" ctx"),t("span",{class:"token punctuation"},"."),o("params\n    ctx"),t("span",{class:"token punctuation"},"."),o("body "),t("span",{class:"token operator"},"="),o(),t("span",{class:"token punctuation"},"{"),o("\n        status"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token number"},"200"),t("span",{class:"token punctuation"},","),o("\n        message"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token string"},"'success'"),t("span",{class:"token punctuation"},","),o("\n        data"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token punctuation"},"{"),o("\n            id"),t("span",{class:"token punctuation"},","),o("\n            nickname"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token string"},"'Forest'"),t("span",{class:"token punctuation"},","),o("\n            age"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token number"},"18"),t("span",{class:"token punctuation"},","),o("\n            jobs"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token string"},"'前端攻城狮'"),t("span",{class:"token punctuation"},","),o("\n            skills"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token string"},"'搬砖'"),o("\n        "),t("span",{class:"token punctuation"},"}"),o("\n    "),t("span",{class:"token punctuation"},"}"),o("\n"),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},")"),o("\n\nrouter"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"post"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'/user'"),t("span",{class:"token punctuation"},","),o(),t("span",{class:"token keyword"},"async"),o(),t("span",{class:"token parameter"},"ctx"),o(),t("span",{class:"token operator"},"=>"),o(),t("span",{class:"token punctuation"},"{"),o("\n    "),t("span",{class:"token keyword"},"const"),o(),t("span",{class:"token punctuation"},"{"),o(" name"),t("span",{class:"token punctuation"},","),o(" age "),t("span",{class:"token punctuation"},"}"),o(),t("span",{class:"token operator"},"="),o(" ctx"),t("span",{class:"token punctuation"},"."),o("request"),t("span",{class:"token punctuation"},"."),o("body\n    ctx"),t("span",{class:"token punctuation"},"."),o("body "),t("span",{class:"token operator"},"="),o(),t("span",{class:"token punctuation"},"{"),o("\n        status"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token number"},"200"),t("span",{class:"token punctuation"},","),o("\n        data"),t("span",{class:"token operator"},":"),o(),t("span",{class:"token punctuation"},"{"),o("\n            name"),t("span",{class:"token punctuation"},","),o("\n            age\n        "),t("span",{class:"token punctuation"},"}"),o("\n    "),t("span",{class:"token punctuation"},"}"),o("\n"),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},")"),o("\n\napp"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"use"),t("span",{class:"token punctuation"},"("),t("span",{class:"token function"},"koaBody"),t("span",{class:"token punctuation"},"("),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"use"),t("span",{class:"token punctuation"},"("),o("router"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"routes"),t("span",{class:"token punctuation"},"("),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"use"),t("span",{class:"token punctuation"},"("),o("router"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"allowedMethods"),t("span",{class:"token punctuation"},"("),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},")"),o("\n\napp"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"listen"),t("span",{class:"token punctuation"},"("),t("span",{class:"token number"},"3003"),t("span",{class:"token punctuation"},")"),o("\n")])])],-1),en=t("div",{class:"tip custom-block"},[t("p",{class:"custom-block-title"},"TIP"),t("p",null,"koa-body 中间件的引入顺序必须在 router 之前，否则获取不了 post 请求携带的数据")],-1);c.render=function(t,o,e,c,cn,pn){return n(),s("div",null,[p,l,u,k,i,r,d,m,g,f,a(" ![img](./1.png) "),y,h,w,x,b,v,j,q,R,K,P,F,M,S,T,A,C,I,N,$,D,E,_,B,G,H,J,U,W,z,L,O,Q,V,X,Y,Z,nn,sn,an,tn,on,en])};export default c;export{e as __pageData};
