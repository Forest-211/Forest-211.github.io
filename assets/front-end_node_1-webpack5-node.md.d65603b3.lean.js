import{o as n,c as s,d as a,e as t}from"./app.1b6ffbfc.js";const e='{"title":"webpack5 构建应用","description":"","frontmatter":{},"headers":[{"level":2,"title":"Tasking","slug":"tasking"},{"level":2,"title":"项目最终目录结构","slug":"项目最终目录结构"},{"level":2,"title":"搭建项目","slug":"搭建项目"},{"level":3,"title":"安装koa、@koa/router","slug":"安装koa、-koa-router"},{"level":3,"title":"创建入口文件","slug":"创建入口文件"},{"level":3,"title":"安装支持 es6 的依赖","slug":"安装支持-es6-的依赖"},{"level":3,"title":"在项目根目录添加.babelrc文件","slug":"在项目根目录添加-babelrc文件"},{"level":3,"title":"添加测试接口","slug":"添加测试接口"},{"level":3,"title":"启动服务","slug":"启动服务"},{"level":3,"title":"在 postman 中请求接口","slug":"在-postman-中请求接口"},{"level":3,"title":"配置 webpack 英文文档 中文文档","slug":"配置-webpack-英文文档-中文文档"},{"level":3,"title":"测试构建","slug":"测试构建"},{"level":3,"title":"优化构建配置","slug":"优化构建配置"},{"level":2,"title":"配置项目规范","slug":"配置项目规范"},{"level":3,"title":"集成 EditorConfig 配置","slug":"集成-editorconfig-配置"},{"level":3,"title":"集成 Prettier 配置","slug":"集成-prettier-配置"},{"level":3,"title":"集成 ESLint 配置","slug":"集成-eslint-配置"},{"level":3,"title":"解决 Prettier 和 ESLint 的冲突","slug":"解决-prettier-和-eslint-的冲突"},{"level":3,"title":"集成 husky 和 lint-staged","slug":"集成-husky-和-lint-staged"},{"level":2,"title":"路由自动注册","slug":"路由自动注册"},{"level":2,"title":"配置别名","slug":"配置别名"}],"relativePath":"front-end/node/1-webpack5-node.md","lastUpdated":1627701645581}',o={},l=a("h1",{id:"webpack5-构建应用"},[a("a",{class:"header-anchor",href:"#webpack5-构建应用","aria-hidden":"true"},"#"),t(" webpack5 构建应用")],-1),c=a("h2",{id:"tasking"},[a("a",{class:"header-anchor",href:"#tasking","aria-hidden":"true"},"#"),t(" Tasking")],-1),p=a("ul",null,[a("li",null,"支持 es6+语法"),a("li",null,"开发热更新"),a("li",null,"RESTful 接口构建"),a("li",null,"路由合并，路由自动注册"),a("li",null,"webpack5 构建")],-1),u=a("h2",{id:"项目最终目录结构"},[a("a",{class:"header-anchor",href:"#项目最终目录结构","aria-hidden":"true"},"#"),t(" 项目最终目录结构")],-1),r=a("h2",{id:"搭建项目"},[a("a",{class:"header-anchor",href:"#搭建项目","aria-hidden":"true"},"#"),t(" 搭建项目")],-1),i=a("div",{class:"language-shell"},[a("pre",null,[a("code",null,[t("// 创建项目目录\n$ "),a("span",{class:"token function"},"mkdir"),t(),a("span",{class:"token function"},"service"),t("\n\n// 进入service文件夹\n$ "),a("span",{class:"token builtin class-name"},"cd"),t(),a("span",{class:"token function"},"service"),t("\n\n// 初始化package.json\n$ "),a("span",{class:"token function"},"npm"),t(" init -y\n\n// 创建源码目录\n"),a("span",{class:"token function"},"mkdir"),t(" src\n")])])],-1),k=a("h3",{id:"安装koa、-koa-router"},[a("a",{class:"header-anchor",href:"#安装koa、-koa-router","aria-hidden":"true"},"#"),t(" 安装"),a("code",null,"koa"),t("、"),a("code",null,"@koa/router")],-1),d=a("div",{class:"language-shell"},[a("pre",null,[a("code",null,[t("$ "),a("span",{class:"token function"},"yarn"),t(),a("span",{class:"token function"},"add"),t(" koa @koa/router\n")])])],-1),g=a("h3",{id:"创建入口文件"},[a("a",{class:"header-anchor",href:"#创建入口文件","aria-hidden":"true"},"#"),t(" 创建入口文件")],-1),m=a("div",{class:"language-shell"},[a("pre",null,[a("code",null,[t("$ "),a("span",{class:"token function"},"touch"),t(" src/app.js\n")])])],-1),f=a("h3",{id:"安装支持-es6-的依赖"},[a("a",{class:"header-anchor",href:"#安装支持-es6-的依赖","aria-hidden":"true"},"#"),t(" 安装支持 es6 的依赖")],-1),b=a("div",{class:"language-shell"},[a("pre",null,[a("code",null,[t("$ "),a("span",{class:"token function"},"yarn"),t(),a("span",{class:"token function"},"add"),t(" -D webpack webpack-cli @babel/node @babel/core @babel/preset-env babel-loader clean-webpack-plugin nodemon webpack-node-externals webpack-merge rimraf\n")])])],-1),h=a("h3",{id:"在项目根目录添加-babelrc文件"},[a("a",{class:"header-anchor",href:"#在项目根目录添加-babelrc文件","aria-hidden":"true"},"#"),t(" 在项目根目录添加"),a("code",null,".babelrc"),t("文件")],-1),w=a("div",{class:"language-json"},[a("pre",null,[a("code",null,[a("span",{class:"token punctuation"},"{"),t("\n    "),a("span",{class:"token property"},'"presets"'),a("span",{class:"token operator"},":"),t(),a("span",{class:"token punctuation"},"["),t("\n        "),a("span",{class:"token punctuation"},"["),t("\n            "),a("span",{class:"token string"},'"@babel/preset-env"'),a("span",{class:"token punctuation"},","),t("\n            "),a("span",{class:"token punctuation"},"{"),t("\n                "),a("span",{class:"token property"},'"targets"'),a("span",{class:"token operator"},":"),t(),a("span",{class:"token punctuation"},"{"),t("\n                    "),a("span",{class:"token property"},'"node"'),a("span",{class:"token operator"},":"),t(),a("span",{class:"token string"},'"current"'),t("\n                "),a("span",{class:"token punctuation"},"}"),t("\n            "),a("span",{class:"token punctuation"},"}"),t("\n        "),a("span",{class:"token punctuation"},"]"),t("\n    "),a("span",{class:"token punctuation"},"]"),t("\n"),a("span",{class:"token punctuation"},"}"),t("\n")])])],-1),y=a("h3",{id:"添加测试接口"},[a("a",{class:"header-anchor",href:"#添加测试接口","aria-hidden":"true"},"#"),t(" 添加测试接口")],-1),v=a("blockquote",null,[a("p",null,[t("在"),a("code",null,"app.js"),t("中添加测试接口，由于已经配置了"),a("code",null,"babel"),t("解析，所以可以直接在"),a("code",null,"app.js"),t("中写 es6+语法")])],-1),j=a("div",{class:"language-javascript"},[a("pre",null,[a("code",null,[a("span",{class:"token keyword"},"import"),t(" Koa "),a("span",{class:"token keyword"},"from"),t(),a("span",{class:"token string"},"'koa'"),t("\n"),a("span",{class:"token keyword"},"import"),t(" Router "),a("span",{class:"token keyword"},"from"),t(),a("span",{class:"token string"},"'@koa/router'"),t("\n\n"),a("span",{class:"token keyword"},"const"),t(" app "),a("span",{class:"token operator"},"="),t(),a("span",{class:"token keyword"},"new"),t(),a("span",{class:"token class-name"},"Koa"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),t("\n"),a("span",{class:"token keyword"},"const"),t(" router "),a("span",{class:"token operator"},"="),t(),a("span",{class:"token keyword"},"new"),t(),a("span",{class:"token class-name"},"Router"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),t("\n\nrouter"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"get"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'/'"),a("span",{class:"token punctuation"},","),t(),a("span",{class:"token keyword"},"async"),t(),a("span",{class:"token parameter"},"ctx"),t(),a("span",{class:"token operator"},"=>"),t(),a("span",{class:"token punctuation"},"{"),t("\n    ctx"),a("span",{class:"token punctuation"},"."),t("body "),a("span",{class:"token operator"},"="),t(),a("span",{class:"token punctuation"},"{"),t("\n        status"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token number"},"200"),a("span",{class:"token punctuation"},","),t("\n        message"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token string"},"'success'"),a("span",{class:"token punctuation"},","),t("\n        data"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token punctuation"},"{"),t("\n            nickname"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token string"},"'Forest'"),a("span",{class:"token punctuation"},","),t("\n            title"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token string"},"'前端工程师'"),a("span",{class:"token punctuation"},","),t("\n            content"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token string"},"'webpack5构建node应用'"),t("\n        "),a("span",{class:"token punctuation"},"}"),t("\n    "),a("span",{class:"token punctuation"},"}"),t("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),t("\n\napp"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"use"),a("span",{class:"token punctuation"},"("),t("router"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"routes"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"use"),a("span",{class:"token punctuation"},"("),t("router"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"allowedMethods"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},")"),t("\n\n"),a("span",{class:"token keyword"},"const"),t(" port "),a("span",{class:"token operator"},"="),t(),a("span",{class:"token number"},"3002"),t("\napp"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"listen"),a("span",{class:"token punctuation"},"("),t("port"),a("span",{class:"token punctuation"},","),t(),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),t(),a("span",{class:"token operator"},"=>"),t(" console"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"log"),a("span",{class:"token punctuation"},"("),a("span",{class:"token template-string"},[a("span",{class:"token template-punctuation string"},"`"),a("span",{class:"token string"},"服务启动在"),a("span",{class:"token interpolation"},[a("span",{class:"token interpolation-punctuation punctuation"},"${"),t("port"),a("span",{class:"token interpolation-punctuation punctuation"},"}")]),a("span",{class:"token string"},"端口"),a("span",{class:"token template-punctuation string"},"`")]),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},")"),t("\n")])])],-1),x=a("h3",{id:"启动服务"},[a("a",{class:"header-anchor",href:"#启动服务","aria-hidden":"true"},"#"),t(" 启动服务")],-1),E=a("div",{class:"language-shell"},[a("pre",null,[a("code",null,"$ npx babel-node src/app.js\n")])],-1),q=a("h3",{id:"在-postman-中请求接口"},[a("a",{class:"header-anchor",href:"#在-postman-中请求接口","aria-hidden":"true"},"#"),t(" 在 postman 中请求接口")],-1),S=a("p",null,[a("img",{src:"/assets/image-20210504072925109.648b28a1.png",alt:"image-20210504072925109"})],-1),C=a("h3",{id:"配置-webpack-英文文档-中文文档"},[a("a",{class:"header-anchor",href:"#配置-webpack-英文文档-中文文档","aria-hidden":"true"},"#"),t(" 配置 webpack "),a("a",{href:"https://webpack.js.org/concepts/",target:"_blank",rel:"noopener noreferrer"},"英文文档"),t(),a("a",{href:"https://webpack.docschina.org/concepts/",target:"_blank",rel:"noopener noreferrer"},"中文文档")],-1),_=a("div",{class:"tip custom-block"},[a("p",{class:"custom-block-title"},"核心概念"),a("ul",null,[a("li",null,[a("p",null,[a("strong",null,"entry"),t("：入口；指示 "),a("code",null,"webpack"),t(" 应该使用哪个模块，默认值是 "),a("code",null,"./src/index.js")])]),a("li",null,[a("p",null,[a("strong",null,"output"),t("：输出；"),a("code",null,"output"),t(" 属性告诉 "),a("code",null,"webpack"),t(" 在哪里输出它所创建的 "),a("em",null,"bundle"),t("，默认值是 "),a("code",null,"./dist/main.js")])]),a("li",null,[a("p",null,[a("strong",null,"loader"),t("：loader 负责完成项目中各种各样资源模块的加载")])]),a("li",null,[a("p",null,[a("strong",null,"plugins"),t("：插件；用来解决项目中除了资源模块打包以外的其他自动化工作。包括：打包优化，资源管理，注入环境变量")])]),a("li",null,[a("p",null,[a("strong",null,"mode"),t("：模式；通过选择 "),a("code",null,"development"),t(", "),a("code",null,"production"),t(" 或 "),a("code",null,"none"),t(" 之中的一个，来设置 "),a("code",null,"mode"),t(" 参数，你可以启用 webpack 内置在相应环境下的优化。其默认值为 "),a("code",null,"production"),t("。")])])])],-1),D=a("blockquote",null,[a("p",null,[t("在项目根目录创建"),a("code",null,"webpack.config.js"),t("文件")])],-1),P=a("div",{class:"language-javascript"},[a("pre",null,[a("code",null,[a("span",{class:"token keyword"},"const"),t(),a("span",{class:"token punctuation"},"{"),t(" DefinePlugin "),a("span",{class:"token punctuation"},"}"),t(),a("span",{class:"token operator"},"="),t(),a("span",{class:"token function"},"require"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'webpack'"),a("span",{class:"token punctuation"},")"),t("\n"),a("span",{class:"token keyword"},"const"),t(" nodeExternals "),a("span",{class:"token operator"},"="),t(),a("span",{class:"token function"},"require"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'webpack-node-externals'"),a("span",{class:"token punctuation"},")"),t("\n"),a("span",{class:"token keyword"},"const"),t(),a("span",{class:"token punctuation"},"{"),t(" CleanWebpackPlugin "),a("span",{class:"token punctuation"},"}"),t(),a("span",{class:"token operator"},"="),t(),a("span",{class:"token function"},"require"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'clean-webpack-plugin'"),a("span",{class:"token punctuation"},")"),t("\n\nmodule"),a("span",{class:"token punctuation"},"."),t("exports "),a("span",{class:"token operator"},"="),t(),a("span",{class:"token punctuation"},"{"),t("\n    "),a("span",{class:"token comment"},"// 打包编译为某一端侧的可使用代码  默认值：web  https://webpack.docschina.org/configuration/target/"),t("\n    target"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token string"},"'node'"),a("span",{class:"token punctuation"},","),t("\n\n    "),a("span",{class:"token comment"},"// 打包模式，可选择值：development、production"),t("\n    mode"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token string"},"'development'"),a("span",{class:"token punctuation"},","),t("\n\n    "),a("span",{class:"token comment"},"// 控制是否生成，以及如何生成 source map。 https://webpack.docschina.org/configuration/devtool/#root"),t("\n    devtool"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token string"},"'eval-cheap-source-map'"),a("span",{class:"token punctuation"},","),t("\n\n    "),a("span",{class:"token comment"},"// 打包模块入口文件"),t("\n    entry"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token punctuation"},"{"),t("\n        server"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token template-string"},[a("span",{class:"token template-punctuation string"},"`"),a("span",{class:"token interpolation"},[a("span",{class:"token interpolation-punctuation punctuation"},"${"),t("process"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"cwd"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token interpolation-punctuation punctuation"},"}")]),a("span",{class:"token string"},"/src/app.js"),a("span",{class:"token template-punctuation string"},"`")]),t("\n    "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},","),t("\n\n    "),a("span",{class:"token comment"},"// 打包后的输入文件"),t("\n    output"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token punctuation"},"{"),t("\n        filename"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token string"},"'[name].bundle.js'"),a("span",{class:"token punctuation"},","),t("\n        path"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token template-string"},[a("span",{class:"token template-punctuation string"},"`"),a("span",{class:"token interpolation"},[a("span",{class:"token interpolation-punctuation punctuation"},"${"),t("process"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"cwd"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token interpolation-punctuation punctuation"},"}")]),a("span",{class:"token string"},"/dist"),a("span",{class:"token template-punctuation string"},"`")]),t("\n    "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},","),t("\n\n    "),a("span",{class:"token comment"},"// 匹配解析规则"),t("\n    module"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token punctuation"},"{"),t("\n        rules"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token punctuation"},"["),t("\n            "),a("span",{class:"token punctuation"},"{"),t("\n                test"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token regex"},[a("span",{class:"token regex-delimiter"},"/"),a("span",{class:"token regex-source language-regex"},"\\.(js|jsx)$"),a("span",{class:"token regex-delimiter"},"/")]),a("span",{class:"token punctuation"},","),t("\n                use"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token punctuation"},"{"),t("\n                    loader"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token string"},"'babel-loader'"),t("\n                "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},","),t("\n                exclude"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token punctuation"},"["),a("span",{class:"token template-string"},[a("span",{class:"token template-punctuation string"},"`"),a("span",{class:"token interpolation"},[a("span",{class:"token interpolation-punctuation punctuation"},"${"),t("process"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"cwd"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token interpolation-punctuation punctuation"},"}")]),a("span",{class:"token string"},"/node_modules"),a("span",{class:"token template-punctuation string"},"`")]),a("span",{class:"token punctuation"},"]"),t("\n            "),a("span",{class:"token punctuation"},"}"),t("\n        "),a("span",{class:"token punctuation"},"]"),t("\n    "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},","),t("\n\n    "),a("span",{class:"token comment"},"// 构建过程中使用的插件"),t("\n    plugins"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token punctuation"},"["),t("\n        "),a("span",{class:"token keyword"},"new"),t(),a("span",{class:"token class-name"},"CleanWebpackPlugin"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},","),t("\n        "),a("span",{class:"token keyword"},"new"),t(),a("span",{class:"token class-name"},"DefinePlugin"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},"{"),t("\n            "),a("span",{class:"token string"},[t("'process."),a("wbr"),t("env'")]),a("span",{class:"token operator"},":"),t(),a("span",{class:"token punctuation"},"{"),t("\n                "),a("span",{class:"token constant"},"NODE_ENV"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token constant"},"JSON"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"stringify"),a("span",{class:"token punctuation"},"("),t("\n                    process"),a("span",{class:"token punctuation"},"."),t("env"),a("span",{class:"token punctuation"},"."),a("span",{class:"token constant"},"NODE_ENV"),t(),a("span",{class:"token operator"},"==="),t(),a("span",{class:"token string"},"'production'"),t(),a("span",{class:"token operator"},"||"),t("\n                        process"),a("span",{class:"token punctuation"},"."),t("env"),a("span",{class:"token punctuation"},"."),a("span",{class:"token constant"},"NODE_ENV"),t(),a("span",{class:"token operator"},"==="),t(),a("span",{class:"token string"},"'prod'"),t("\n                        "),a("span",{class:"token operator"},"?"),t(),a("span",{class:"token string"},"'production'"),t("\n                        "),a("span",{class:"token operator"},":"),t(),a("span",{class:"token string"},"'development'"),t("\n                "),a("span",{class:"token punctuation"},")"),t("\n            "),a("span",{class:"token punctuation"},"}"),t("\n        "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),t("\n    "),a("span",{class:"token punctuation"},"]"),a("span",{class:"token punctuation"},","),t("\n\n    "),a("span",{class:"token comment"},"// 防止第三方依赖被打包"),t("\n    externals"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token punctuation"},"["),a("span",{class:"token function"},"nodeExternals"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},"]"),t("\n"),a("span",{class:"token punctuation"},"}"),t("\n")])])],-1),L=a("h3",{id:"测试构建"},[a("a",{class:"header-anchor",href:"#测试构建","aria-hidden":"true"},"#"),t(" 测试构建")],-1),$=a("div",{class:"language-shell"},[a("pre",null,[a("code",null,"$ npx webpack\n")])],-1),N=a("p",null,[a("img",{src:"/assets/image-20210504083042708.e23cdde5.png",alt:"image-20210504083042708"}),a("img",{src:"/assets/image-20210504083112577.3a29b09e.png",alt:"image-20210504083112577"})],-1),W=a("blockquote",null,[a("p",null,"构建成功！")],-1),T=a("div",{class:"warning custom-block"},[a("p",{class:"custom-block-title"},"思考"),a("p",null,"在实际开发中可能会存在开发环境和生产环境的构建，所以单凭一个配置还不能达到实际的需求，接下来对开发环境和生产环境分别配置。")],-1),R=a("blockquote",null,[a("p",null,[t("在项目根目录创建 config 文件，并创建三个文件分别是"),a("code",null,"webpack.config.base.js"),t("、"),a("code",null,"webpack.config.dev.js"),t("、"),a("code",null,"webpack.config.prod.js")]),a("ul",null,[a("li",null,[a("code",null,"webpack.config.base.js"),t(" 文件存放开发环境和生产环境都是需要的构建配置")]),a("li",null,[a("code",null,"webpack.config.dev.js"),t(" 文件存放开发环境的构建配置")]),a("li",null,[a("code",null,"webpack.config.prod.js"),t(" 存放生产环境的构建配置")])])],-1),V=a("h3",{id:"优化构建配置"},[a("a",{class:"header-anchor",href:"#优化构建配置","aria-hidden":"true"},"#"),t(" 优化构建配置")],-1),O=a("blockquote",null,[a("ul",null,[a("li",null,[t("mode 独立于构建环境，开发环境为("),a("code",null,"development"),t(")、生产环境为("),a("code",null,"production"),t(")")]),a("li",null,"devtool 只有在开发环境下才会存在"),a("li",null,[a("a",{href:"https://webpack.docschina.org/configuration/stats/",target:"_blank",rel:"noopener noreferrer"},"stats"),t(" 属性让你更精确地控制打包后的信息该怎么显示")])])],-1),J=a("div",{class:"tip custom-block"},[a("p",{class:"custom-block-title"},"TIP"),a("p",null,[t("由于每个开发环境和生产环境都是独立的构建配置，所以要在构建时要合并基础配置；安装"),a("code",null,"webpack-merge"),t("合并构建配置")]),a("div",{class:"language-shell"},[a("pre",null,[a("code",null,[t("$ "),a("span",{class:"token function"},"npm"),t(" i -D webpack-merge\n")])])])],-1),A=a("ul",null,[a("li",null,"优化 webpack.config.base.js")],-1),G=a("div",{class:"language-javascript"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// config/webpack.config.base.js"),t("\n"),a("span",{class:"token keyword"},"const"),t(),a("span",{class:"token punctuation"},"{"),t(" DefinePlugin "),a("span",{class:"token punctuation"},"}"),t(),a("span",{class:"token operator"},"="),t(),a("span",{class:"token function"},"require"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'webpack'"),a("span",{class:"token punctuation"},")"),t("\n"),a("span",{class:"token keyword"},"const"),t(" nodeExternals "),a("span",{class:"token operator"},"="),t(),a("span",{class:"token function"},"require"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'webpack-node-externals'"),a("span",{class:"token punctuation"},")"),t("\n"),a("span",{class:"token keyword"},"const"),t(),a("span",{class:"token punctuation"},"{"),t(" CleanWebpackPlugin "),a("span",{class:"token punctuation"},"}"),t(),a("span",{class:"token operator"},"="),t(),a("span",{class:"token function"},"require"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'clean-webpack-plugin'"),a("span",{class:"token punctuation"},")"),t("\n\nmodule"),a("span",{class:"token punctuation"},"."),t("exports "),a("span",{class:"token operator"},"="),t(),a("span",{class:"token punctuation"},"{"),t("\n    "),a("span",{class:"token comment"},"// 打包编译为某一端侧的可使用代码  默认值：web  https://webpack.docschina.org/configuration/target/"),t("\n    target"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token string"},"'node'"),a("span",{class:"token punctuation"},","),t("\n\n    "),a("span",{class:"token comment"},"// 打包模式，可选择值：development、production"),t("\n    "),a("span",{class:"token comment"},'// mode: "development",'),t("\n\n    "),a("span",{class:"token comment"},"// 控制是否生成，以及如何生成 source map。 https://webpack.docschina.org/configuration/devtool/#root"),t("\n    "),a("span",{class:"token comment"},'// devtool: "eval-cheap-source-map",'),t("\n\n    "),a("span",{class:"token comment"},"// 打包模块入口文件"),t("\n    entry"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token punctuation"},"{"),t("\n        server"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token template-string"},[a("span",{class:"token template-punctuation string"},"`"),a("span",{class:"token interpolation"},[a("span",{class:"token interpolation-punctuation punctuation"},"${"),t("process"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"cwd"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token interpolation-punctuation punctuation"},"}")]),a("span",{class:"token string"},"/src/app.js"),a("span",{class:"token template-punctuation string"},"`")]),t("\n    "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},","),t("\n\n    "),a("span",{class:"token comment"},"// 打包后的输入文件"),t("\n    output"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token punctuation"},"{"),t("\n        filename"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token string"},"'[name].bundle.js'"),a("span",{class:"token punctuation"},","),t("\n        path"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token template-string"},[a("span",{class:"token template-punctuation string"},"`"),a("span",{class:"token interpolation"},[a("span",{class:"token interpolation-punctuation punctuation"},"${"),t("process"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"cwd"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token interpolation-punctuation punctuation"},"}")]),a("span",{class:"token string"},"/dist"),a("span",{class:"token template-punctuation string"},"`")]),t("\n    "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},","),t("\n\n    "),a("span",{class:"token comment"},"// 匹配解析规则"),t("\n    module"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token punctuation"},"{"),t("\n        rules"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token punctuation"},"["),t("\n            "),a("span",{class:"token punctuation"},"{"),t("\n                test"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token regex"},[a("span",{class:"token regex-delimiter"},"/"),a("span",{class:"token regex-source language-regex"},"\\.(js|jsx)$"),a("span",{class:"token regex-delimiter"},"/")]),a("span",{class:"token punctuation"},","),t("\n                use"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token punctuation"},"{"),t("\n                    loader"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token string"},"'babel-loader'"),t("\n                "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},","),t("\n                exclude"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token punctuation"},"["),a("span",{class:"token template-string"},[a("span",{class:"token template-punctuation string"},"`"),a("span",{class:"token interpolation"},[a("span",{class:"token interpolation-punctuation punctuation"},"${"),t("process"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"cwd"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token interpolation-punctuation punctuation"},"}")]),a("span",{class:"token string"},"/node_modules"),a("span",{class:"token template-punctuation string"},"`")]),a("span",{class:"token punctuation"},"]"),t("\n            "),a("span",{class:"token punctuation"},"}"),t("\n        "),a("span",{class:"token punctuation"},"]"),t("\n    "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},","),t("\n\n    "),a("span",{class:"token comment"},"// 构建过程中使用的插件"),t("\n    plugins"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token punctuation"},"["),t("\n        "),a("span",{class:"token keyword"},"new"),t(),a("span",{class:"token class-name"},"CleanWebpackPlugin"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},","),t("\n        "),a("span",{class:"token keyword"},"new"),t(),a("span",{class:"token class-name"},"DefinePlugin"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},"{"),t("\n            "),a("span",{class:"token string"},[t("'process."),a("wbr"),t("env'")]),a("span",{class:"token operator"},":"),t(),a("span",{class:"token punctuation"},"{"),t("\n                "),a("span",{class:"token comment"},"// 设置环境变量 NODE_ENV"),t("\n                "),a("span",{class:"token constant"},"NODE_ENV"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token constant"},"JSON"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"stringify"),a("span",{class:"token punctuation"},"("),t("\n                    process"),a("span",{class:"token punctuation"},"."),t("env"),a("span",{class:"token punctuation"},"."),a("span",{class:"token constant"},"NODE_ENV"),t(),a("span",{class:"token operator"},"==="),t(),a("span",{class:"token string"},"'production'"),t(),a("span",{class:"token operator"},"||"),t("\n                        process"),a("span",{class:"token punctuation"},"."),t("env"),a("span",{class:"token punctuation"},"."),a("span",{class:"token constant"},"NODE_ENV"),t(),a("span",{class:"token operator"},"==="),t(),a("span",{class:"token string"},"'prod'"),t("\n                        "),a("span",{class:"token operator"},"?"),t(),a("span",{class:"token string"},"'production'"),t("\n                        "),a("span",{class:"token operator"},":"),t(),a("span",{class:"token string"},"'development'"),t("\n                "),a("span",{class:"token punctuation"},")"),t("\n            "),a("span",{class:"token punctuation"},"}"),t("\n        "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),t("\n    "),a("span",{class:"token punctuation"},"]"),a("span",{class:"token punctuation"},","),t("\n\n    "),a("span",{class:"token comment"},"// 防止第三方依赖被打包"),t("\n    externals"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token punctuation"},"["),a("span",{class:"token function"},"nodeExternals"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},"]"),t("\n"),a("span",{class:"token punctuation"},"}"),t("\n")])])],-1),H=a("ul",null,[a("li",null,"开发环境的构建配置")],-1),z=a("div",{class:"language-javascript"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// config/webpack.config.dev.js"),t("\n"),a("span",{class:"token keyword"},"const"),t(),a("span",{class:"token punctuation"},"{"),t(" merge "),a("span",{class:"token punctuation"},"}"),t(),a("span",{class:"token operator"},"="),t(),a("span",{class:"token function"},"require"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'webpack-merge'"),a("span",{class:"token punctuation"},")"),t("\n"),a("span",{class:"token keyword"},"const"),t(" baseWebpackConfig "),a("span",{class:"token operator"},"="),t(),a("span",{class:"token function"},"require"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'./webpack.config.base'"),a("span",{class:"token punctuation"},")"),t("\n\n"),a("span",{class:"token keyword"},"const"),t(" webpackConfig "),a("span",{class:"token operator"},"="),t(),a("span",{class:"token function"},"merge"),a("span",{class:"token punctuation"},"("),t("baseWebpackConfig"),a("span",{class:"token punctuation"},","),t(),a("span",{class:"token punctuation"},"{"),t("\n    devtool"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token string"},"'eval-cheap-source-map'"),a("span",{class:"token punctuation"},","),t("\n    mode"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token string"},"'development'"),a("span",{class:"token punctuation"},","),t("\n\n    "),a("span",{class:"token comment"},"// 是否添加关于子模块的信息。"),t("\n    stats"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token punctuation"},"{"),t(" children"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token boolean"},"false"),t(),a("span",{class:"token punctuation"},"}"),t("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),t("\n\nmodule"),a("span",{class:"token punctuation"},"."),t("exports "),a("span",{class:"token operator"},"="),t(" webpackConfig\n")])])],-1),K=a("ul",null,[a("li",null,"生产环境的构建配置")],-1),I=a("blockquote",null,[a("p",null,[t("生产环境构建时要进行代码压缩，安装"),a("code",null,"terser-webpack-plugin"),t("， 命令："),a("code",null,"npm i -D terser-webpack-plugin")])],-1),M=a("div",{class:"language-javascript"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// config/webpack.config.prod.js"),t("\n"),a("span",{class:"token keyword"},"const"),t(),a("span",{class:"token punctuation"},"{"),t(" merge "),a("span",{class:"token punctuation"},"}"),t(),a("span",{class:"token operator"},"="),t(),a("span",{class:"token function"},"require"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'webpack-merge'"),a("span",{class:"token punctuation"},")"),t("\n"),a("span",{class:"token keyword"},"const"),t(" TersetWebpackPlugin "),a("span",{class:"token operator"},"="),t(),a("span",{class:"token function"},"require"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'terser-webpack-plugin'"),a("span",{class:"token punctuation"},")"),t("\n"),a("span",{class:"token keyword"},"const"),t(" baseWebpackConfig "),a("span",{class:"token operator"},"="),t(),a("span",{class:"token function"},"require"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'./webpack.config.base'"),a("span",{class:"token punctuation"},")"),t("\n\n"),a("span",{class:"token keyword"},"const"),t(" webpackConfig "),a("span",{class:"token operator"},"="),t(),a("span",{class:"token function"},"merge"),a("span",{class:"token punctuation"},"("),t("baseWebpackConfig"),a("span",{class:"token punctuation"},","),t(),a("span",{class:"token punctuation"},"{"),t("\n    devtool"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token string"},"'eval-cheap-source-map'"),a("span",{class:"token punctuation"},","),t("\n    mode"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token string"},"'production'"),a("span",{class:"token punctuation"},","),t("\n    stats"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token punctuation"},"{"),t(" children"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token boolean"},"false"),t(),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},","),t("\n\n    "),a("span",{class:"token comment"},"// 优化配置"),t("\n    optimization"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token punctuation"},"{"),t("\n        "),a("span",{class:"token comment"},"// 压缩配置"),t("\n        minimize"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token boolean"},"true"),a("span",{class:"token punctuation"},","),t("\n        minimizer"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token punctuation"},"["),a("span",{class:"token keyword"},"new"),t(),a("span",{class:"token class-name"},"TersetWebpackPlugin"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},"]"),a("span",{class:"token punctuation"},","),t("\n\n        "),a("span",{class:"token comment"},"// 分块策略"),t("\n        splitChunks"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token punctuation"},"{"),t("\n            "),a("span",{class:"token comment"},"// 缓存组 https://webpack.docschina.org/plugins/split-chunks-plugin/#splitchunkscachegroups"),t("\n            cacheGroups"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token punctuation"},"{"),t("\n                commens"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token punctuation"},"{"),t("\n                    name"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token string"},"'commons'"),a("span",{class:"token punctuation"},","),t("\n                    chunks"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token string"},"'initial'"),a("span",{class:"token punctuation"},","),t("\n                    minChunks"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token number"},"3"),a("span",{class:"token punctuation"},","),t("\n                    enforce"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token boolean"},"true"),t("\n                "),a("span",{class:"token punctuation"},"}"),t("\n            "),a("span",{class:"token punctuation"},"}"),t("\n        "),a("span",{class:"token punctuation"},"}"),t("\n    "),a("span",{class:"token punctuation"},"}"),t("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),t("\n\nmodule"),a("span",{class:"token punctuation"},"."),t("exports "),a("span",{class:"token operator"},"="),t(" webpackConfig\n")])])],-1),Q=a("ul",null,[a("li",null,[a("p",null,"添加构建脚本命令"),a("blockquote",null,[a("p",null,[t("设置环境变量"),a("code",null,"NODE_ENV"),t("，由于各环境配置的差异问题，"),a("code",null,"cross-env"),t("可以有效的解决跨平台设置环境变量的问题；它是运行跨平台设置和使用环境变量(Node 中的环境变量)的脚本。安装命令："),a("code",null,"npm i -D cross-env"),t(" 安装成功后配置构建命令:")]),a("ul",null,[a("li",null,[t("在"),a("code",null,"package.json"),t("的"),a("code",null,"scripts"),t("中添加如下命令：")])]),a("div",{class:"language-json"},[a("pre",null,[a("code",null,[a("span",{class:"token property"},'"build"'),a("span",{class:"token operator"},":"),t(),a("span",{class:"token string"},'"cross-env NODE_ENV=prod webpack --config config/webpack.config.prod.js"'),a("span",{class:"token punctuation"},","),t("\n"),a("span",{class:"token property"},'"dev"'),a("span",{class:"token operator"},":"),t(),a("span",{class:"token string"},'"cross-env NODE_ENV=dev nodemon --exec babel-node --inspect src/app.js"'),a("span",{class:"token punctuation"},","),t("\n")])])])])]),a("li",null,[a("p",null,"启动开发环境服务")])],-1),U=a("div",{class:"language-shell"},[a("pre",null,[a("code",null,[t("$ "),a("span",{class:"token function"},"npm"),t(" run dev\n")])])],-1),F=a("p",null,"运行之后的效果图如下：",-1),X=a("p",null,[a("img",{src:"/assets/image-20210504095318351.b7234ff3.png",alt:"image-20210504095318351"})],-1),Y=a("ul",null,[a("li",null,"启动编译构建命令")],-1),B=a("div",{class:"language-shell"},[a("pre",null,[a("code",null,[t("$ "),a("span",{class:"token function"},"npm"),t(" run build\n")])])],-1),Z=a("p",null,"运行效果如下图：",-1),nn=a("p",null,[a("img",{src:"/assets/image-20210504095540666.66fb03ab.png",alt:"image-20210504095540666"})],-1),sn=a("p",null,"查看 dist 文件夹下被编译后的文件：",-1),an=a("p",null,[a("img",{src:"/assets/image-20210504095736714.d340e982.png",alt:"image-20210504095736714"})],-1),tn=a("blockquote",null,[a("p",null,"被压缩成了一整行！")],-1),en=a("h2",{id:"配置项目规范"},[a("a",{class:"header-anchor",href:"#配置项目规范","aria-hidden":"true"},"#"),t(" 配置项目规范")],-1),on=a("h3",{id:"集成-editorconfig-配置"},[a("a",{class:"header-anchor",href:"#集成-editorconfig-配置","aria-hidden":"true"},"#"),t(" 集成 EditorConfig 配置")],-1),ln=a("blockquote",null,[a("p",null,[a("strong",null,[a("a",{href:"https://editorconfig.org/",target:"_blank",rel:"noopener noreferrer"},"EditorConfig")]),t(" 有助于为不同 IDE 编辑器上处理同一项目的多个开发人员维护一致的编码风格。")])],-1),cn=a("p",null,"在项目根目录下增加 .editorconfig 文件， 并配置以下内容：",-1),pn=a("div",{class:"language-yaml"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"# Editor configuration, see http://editorconfig.org"),t("\n\n"),a("span",{class:"token comment"},"# 表示是最顶层的 EditorConfig 配置文件"),t("\nroot = true\n\n"),a("span",{class:"token comment"},"# 表示所有文件适用"),t("\n"),a("span",{class:"token punctuation"},"["),t("*"),a("span",{class:"token punctuation"},"]"),t("\n\n"),a("span",{class:"token comment"},"# 设置文件字符集为 utf-8"),t("\ncharset = utf"),a("span",{class:"token punctuation"},"-"),a("span",{class:"token number"},"8"),t("\n\n"),a("span",{class:"token comment"},"# 缩进风格（tab | space）"),t("\nindent_style = space\n\n"),a("span",{class:"token comment"},"# 缩进大小"),t("\nindent_size = 4\n\n"),a("span",{class:"token comment"},"# 控制换行类型(lf | cr | crlf)"),t("\nend_of_line = lf\n\n"),a("span",{class:"token comment"},"# 去除行首的任意空白字符"),t("\ntrim_trailing_whitespace = true\n\n"),a("span",{class:"token comment"},"# 始终在文件末尾插入一个新行"),t("\ninsert_final_newline = true\n\n"),a("span",{class:"token comment"},"# md 文件适用以下规则"),t("\n"),a("span",{class:"token punctuation"},"["),a("span",{class:"token important"},"*.md"),a("span",{class:"token punctuation"},"]"),t("\nmax_line_length = off\ntrim_trailing_whitespace = false\n")])])],-1),un=a("div",{class:"tip custom-block"},[a("p",{class:"custom-block-title"},"注意"),a("p",null,[t("VSCode 使用 EditorConfig 需要去插件市场下载插件 "),a("code",null,"EditorConfig for VS Code"),t(" 。WebStorm 则不需要安装，直接使用 EditorConfig 配置即可。")]),a("p",null,[a("img",{src:"/assets/image-20210504101228402.b87df61b.png",alt:"image-20210504101228402"})])],-1),rn=a("h3",{id:"集成-prettier-配置"},[a("a",{class:"header-anchor",href:"#集成-prettier-配置","aria-hidden":"true"},"#"),t(" 集成 Prettier 配置")],-1),kn=a("blockquote",null,[a("p",null,[a("strong",null,[a("a",{href:"https://prettier.io/",target:"_blank",rel:"noopener noreferrer"},"Prettier")]),t(" 是一款强大的代码格式化工具，支持 "),a("code",null,"JavaScript、TypeScript、CSS、SCSS、Less、JSX、Angular、Vue、GraphQL、JSON、Markdown"),t(" 等语言，基本上前端能用到的文件格式它都可以搞定，是当下最流行的代码格式化工具。")])],-1),dn=a("ul",null,[a("li",null,"安装 Prettier")],-1),gn=a("div",{class:"language-shell"},[a("pre",null,[a("code",null,[t("$ "),a("span",{class:"token function"},"npm"),t(" i prettier -D\n")])])],-1),mn=a("ul",null,[a("li",null,[a("p",null,"创建 Prettier 配置文件 Prettier 支持多种格式的配置文件，比如 .json、.yml、.yaml、.js 等。 在本项目根目录下创建 .prettierrc 文件。")]),a("li",null,[a("p",null,[t("配置 .prettierrc 在本项目中，我们进行如下简单配置，关于更多配置项信息，请前往官网查看 "),a("a",{href:"https://prettier.io/docs/en/options.html",target:"_blank",rel:"noopener noreferrer"},"Prettier-Options"),t(" 。")])])],-1),fn=a("div",{class:"language-json"},[a("pre",null,[a("code",null,[a("span",{class:"token punctuation"},"{"),t("\n    "),a("span",{class:"token property"},'"useTabs"'),a("span",{class:"token operator"},":"),t(),a("span",{class:"token boolean"},"false"),a("span",{class:"token punctuation"},","),t("\n    "),a("span",{class:"token property"},'"tabWidth"'),a("span",{class:"token operator"},":"),t(),a("span",{class:"token number"},"4"),a("span",{class:"token punctuation"},","),t("\n    "),a("span",{class:"token property"},'"printWidth"'),a("span",{class:"token operator"},":"),t(),a("span",{class:"token number"},"100"),a("span",{class:"token punctuation"},","),t("\n    "),a("span",{class:"token property"},'"singleQuote"'),a("span",{class:"token operator"},":"),t(),a("span",{class:"token boolean"},"true"),a("span",{class:"token punctuation"},","),t("\n    "),a("span",{class:"token property"},'"trailingComma"'),a("span",{class:"token operator"},":"),t(),a("span",{class:"token string"},'"none"'),a("span",{class:"token punctuation"},","),t("\n    "),a("span",{class:"token property"},'"bracketSpacing"'),a("span",{class:"token operator"},":"),t(),a("span",{class:"token boolean"},"true"),a("span",{class:"token punctuation"},","),t("\n    "),a("span",{class:"token property"},'"semi"'),a("span",{class:"token operator"},":"),t(),a("span",{class:"token boolean"},"false"),t("\n"),a("span",{class:"token punctuation"},"}"),t("\n")])])],-1),bn=a("p",null,"Prettier 安装且配置好之后，就能使用命令来格式化代码",-1),hn=a("ul",null,[a("li",null,"格式化所有文件（. 表示所有文件）")],-1),wn=a("div",{class:"language-shell"},[a("pre",null,[a("code",null,[t("$ npx prettier --write "),a("span",{class:"token builtin class-name"},"."),t("\n")])])],-1),yn=a("div",{class:"tip custom-block"},[a("p",{class:"custom-block-title"},"注意"),a("p",null,[t("VSCode 编辑器使用 "),a("code",null,"Prettier"),t(" 配置需要下载插件 "),a("code",null,"Prettier - Code formatter"),t("； WebStorm 则不需要安装，直接使用 EditorConfig 配置即可。")]),a("p",null,[a("img",{src:"/assets/image-20210504102416728.9d9b860a.png",alt:"image-20210504102416728"})])],-1),vn=a("h3",{id:"集成-eslint-配置"},[a("a",{class:"header-anchor",href:"#集成-eslint-配置","aria-hidden":"true"},"#"),t(" 集成 ESLint 配置")],-1),jn=a("p",null,[a("a",{href:"https://eslint.org/",target:"_blank",rel:"noopener noreferrer"},"ESLint"),t(" 是一款用于查找并报告代码中问题的工具，并且支持部分问题自动修复。其核心是通过对代码解析得到的 "),a("code",null,"AST"),t("（Abstract Syntax Tree 抽象语法树）进行模式匹配，来分析代码达到检查代码质量和风格问题的能力。 使用 "),a("code",null,"ESLint"),t(" 可以尽可能的避免团队成员之间编程能力和编码习惯不同所造成的代码质量问题，一边写代码一边查找问题，如果发现错误，就给出规则提示，并且自动修复，长期下去，可以促使团队成员往同一种编码风格靠拢。")],-1),xn=a("ul",null,[a("li",null,"安装 eslint")],-1),En=a("div",{class:"language-shell"},[a("pre",null,[a("code",null,[t("$ "),a("span",{class:"token function"},"npm"),t(" i -D eslint\n")])])],-1),qn=a("ul",null,[a("li",null,[a("p",null,"配置 ESLint"),a("blockquote",null,[a("p",null,"ESLint 安装成功后，执行 npx eslint --init，然后按照终端操作提示完成一系列设置来创建配置文件。")])])],-1),Sn=a("p",null,[a("img",{src:"/assets/image-20210504103213588.78feea6a.png",alt:"image-20210504103213588"})],-1),Cn=a("ul",null,[a("li",null,[a("p",null,"How would you like to use ESLint? ...(你想如何使用 ESLint?…)"),a("blockquote",null,[a("p",null,"我这里选择第三个，检查语法，发现问题，并强制代码样式")])])],-1),_n=a("p",null,[a("img",{src:"/assets/image-20210504103418834.2a889938.png",alt:"image-20210504103418834"})],-1),Dn=a("ul",null,[a("li",null,[a("p",null,"What type of modules does your project use? ... （你的项目使用什么类型的模块?…）"),a("blockquote",null,[a("p",null,"项目支持 es6+语法，所以这里就直接选用第一项：JavaScript modules (import/export)")])]),a("li",null,[a("p",null,"Which framework does your project use? ... （你的项目使用哪种框架?…）"),a("blockquote",null,[a("p",null,"这里并未使用 vue 和 react，所以选择 none of these")])])],-1),Pn=a("p",null,[a("img",{src:"/assets/image-20210504104452973.e028f22a.png",alt:"image-20210504104452973"})],-1),Ln=a("ul",null,[a("li",null,[a("p",null,"Does your project use TypeScript? (你的项目使用 TypeScript 吗?)"),a("blockquote",null,[a("p",null,"项目中并没有使用 Typescript，所以选择 No")])])],-1),$n=a("p",null,[a("img",{src:"/assets/image-20210504104610444.28239063.png",alt:"image-20210504104610444"})],-1),Nn=a("ul",null,[a("li",null,[a("p",null,"Where does your code run?(你的代码在哪里运行?)"),a("blockquote",null,[a("p",null,"这是 node 项目，所以不需要选择浏览器环境")])])],-1),Wn=a("p",null,[a("img",{src:"/assets/image-20210504105031201.5a0b2acf.png",alt:"image-20210504105031201"})],-1),Tn=a("ul",null,[a("li",null,[a("p",null,"How would you like to define a style for your project? ... (你想怎样为你的项目定义风格？)"),a("blockquote",null,[a("p",null,"我们这里选择 Use a popular style guide（使用一种流行的风格指南）")])])],-1),Rn=a("p",null,[a("img",{src:"/assets/image-20210504105437959.7ab3babf.png",alt:"image-20210504105437959"})],-1),Vn=a("ul",null,[a("li",null,[a("p",null,"Which style guide do you want to follow? ... (你想遵循哪种风格指南?…)"),a("p",null,[a("img",{src:"/assets/image-20210504105647664.46307f54.png",alt:"image-20210504105647664"})])]),a("li",null,[a("p",null,"What format do you want your config file to be in? ... (您希望配置文件的格式是什么?…)")])],-1),On=a("blockquote",null,[a("p",null,"我这里选择 JavaScript")],-1),Jn=a("ul",null,[a("li",null,[a("p",null,"Would you like to install them now with npm?（你想现在用 npm 安装它们吗?）"),a("blockquote",null,[a("p",null,"默认 Yes，所以可以直接回车")]),a("p",null,[a("img",{src:"/assets/image-20210504110100677.a6ab693a.png",alt:"image-20210504110100677"})])]),a("li",null,[a("p",null,"所有配置如下"),a("p",null,[a("img",{src:"/assets/image-20210504110235680.a75198d8.png",alt:"image-20210504110235680"})])])],-1),An=a("p",null,[t("安装成功后，项目的根目录就会多一个"),a("code",null,".eslintrc.js"),t("文件")],-1),Gn=a("div",{class:"tip custom-block"},[a("p",{class:"custom-block-title"},"注意"),a("p",null,[t("VSCode 使用 ESLint 配置文件需要去插件市场下载插件 ESLint 。 "),a("img",{src:"/assets/image-20210504111438312.3fd71093.png",alt:"image-20210504111438312"})])],-1),Hn=a("h3",{id:"解决-prettier-和-eslint-的冲突"},[a("a",{class:"header-anchor",href:"#解决-prettier-和-eslint-的冲突","aria-hidden":"true"},"#"),t(" 解决 Prettier 和 ESLint 的冲突")],-1),zn=a("p",null,[t("本项目中的 ESLint 配置中使用了 Airbnb JavaScript 风格指南校验，其规则之一是代码结束后面要加分号，而我们在 Prettier 配置文件中加了代码结束后面不加分号的配置项，这样就有冲突了，会出现用 Prettier 格式化后的代码，ESLint 检测到格式有问题的，从而抛出错误提示。 解决两者冲突问题，需要用到 "),a("code",null,"eslint-plugin-prettier"),t(" 和 "),a("code",null,"eslint-config-prettier"),t("。")],-1),Kn=a("blockquote",null,[a("p",null,[a("code",null,"eslint-plugin-prettier"),t(" 将 Prettier 的规则设置到 ESLint 的规则中。")])],-1),In=a("blockquote",null,[a("p",null,[a("code",null,"eslint-config-prettier"),t(" 关闭 ESLint 中与 Prettier 中会发生冲突的规则。")])],-1),Mn=a("p",null,"最后形成优先级：Prettier 配置规则 > ESLint 配置规则。",-1),Qn=a("ul",null,[a("li",null,"安装插件")],-1),Un=a("div",{class:"language-shell"},[a("pre",null,[a("code",null,[t("$ "),a("span",{class:"token function"},"npm"),t(" i eslint-plugin-prettier eslint-config-prettier -D\n")])])],-1),Fn=a("ul",null,[a("li",null,"在 .eslintrc.js 添加 prettier 插件")],-1),Xn=a("div",{class:"language-javascript"},[a("pre",null,[a("code",null,[t("module"),a("span",{class:"token punctuation"},"."),t("exports "),a("span",{class:"token operator"},"="),t(),a("span",{class:"token punctuation"},"{"),t("\n    "),a("span",{class:"token operator"},"..."),t("\n    "),a("span",{class:"token keyword"},"extends"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token punctuation"},"["),t("\n        "),a("span",{class:"token string"},"'airbnb-base'"),a("span",{class:"token punctuation"},","),t("\n        "),a("span",{class:"token string"},"'plugin:prettier/recommended'"),t(),a("span",{class:"token comment"},"// 添加 prettier 插件"),t("\n    "),a("span",{class:"token punctuation"},"]"),a("span",{class:"token punctuation"},","),t("\n    "),a("span",{class:"token operator"},"..."),t("\n"),a("span",{class:"token punctuation"},"}"),t("\n")])])],-1),Yn=a("p",null,[t("这样，我们在执行 "),a("code",null,"eslint --fix"),t(" 命令时，ESLint 就会按照 Prettier 的配置规则来格式化代码，轻松解决二者冲突问题。")],-1),Bn=a("h3",{id:"集成-husky-和-lint-staged"},[a("a",{class:"header-anchor",href:"#集成-husky-和-lint-staged","aria-hidden":"true"},"#"),t(" 集成 husky 和 lint-staged")],-1),Zn=a("p",null,[t("我们在项目中已集成 "),a("code",null,"ESLint"),t(" 和 "),a("code",null,"Prettier"),t("，在编码时，这些工具可以对我们写的代码进行实时校验，在一定程度上能有效规范我们写的代码，但团队可能会有些人觉得这些条条框框的限制很麻烦，选择视“提示”而不见，依旧按自己的一套风格来写代码，或者干脆禁用掉这些工具，开发完成就直接把代码提交到了仓库，日积月累，"),a("code",null,"ESLint"),t(" 也就形同虚设。 所以，我们还需要做一些限制，让没通过 "),a("code",null,"ESLint"),t(" 检测和修复的代码禁止提交，从而保证仓库代码都是符合规范的。 为了解决这个问题，我们需要用到 "),a("code",null,"Git Hook"),t("，在本地执行 "),a("code",null,"git commit"),t(" 的时候，就对所提交的代码进行 "),a("code",null,"ESLint"),t(" 检测和修复（即执行 "),a("code",null,"eslint --fix"),t("），如果这些代码没通过 "),a("code",null,"ESLint"),t(" 规则校验，则禁止提交。 实现这一功能，我们借助 "),a("code",null,"husky + lint-staged"),t(" 。")],-1),ns=a("blockquote",null,[a("p",null,"husky —— Git Hook 工具，可以设置在 git 各个阶段（pre-commit、commit-msg、pre-push 等）触发我们的命令。 lint-staged —— 在 git 暂存的文件上运行 linters。")],-1),ss=a("h4",{id:"配置-husky"},[a("a",{class:"header-anchor",href:"#配置-husky","aria-hidden":"true"},"#"),t(" 配置 husky")],-1),as=a("div",{class:"tip custom-block"},[a("p",{class:"custom-block-title"},"TIP"),a("p",null,"使用 husky-init 命令快速在项目初始化一个 husky 配置。在配置 husky 之前必须初始化 git，否则可能会配置不成功")],-1),ts=a("div",{class:"language-shell"},[a("pre",null,[a("code",null,[t("$ npx husky-init "),a("span",{class:"token operator"},"&&"),t(),a("span",{class:"token function"},"npm"),t(),a("span",{class:"token function"},"install"),t("\n")])])],-1),es=a("p",null,[t("命令执行成功后会在项目的根目录创建一个 "),a("code",null,".husky"),t("文件夹")],-1),os=a("ul",null,[a("li",null,[a("p",null,[t("安装"),a("code",null,"husky"),t("为开发依赖")]),a("p",null,[a("img",{src:"/assets/image-20210504120333648.9e117d44.png",alt:"image-20210504120333648"})])]),a("li",null,[a("p",null,[t("创建"),a("code",null,".husky"),t("文件夹")]),a("p",null,[a("img",{src:"/assets/image-20210504120510820.e0d6bcf9.png",alt:"image-20210504120510820"})])]),a("li",null,[a("p",null,[t("在 "),a("code",null,".husky"),t(" 目录创建 "),a("code",null,"pre-commit"),t(" hook，并初始化 "),a("code",null,"pre-commit"),t(" 命令为 "),a("code",null,"npm test")]),a("p",null,[a("img",{src:"/assets/image-20210504120612932.4f820762.png",alt:"image-20210504120612932"})])]),a("li",null,[a("p",null,[t("修改 "),a("code",null,"package.json"),t(" 的 "),a("code",null,"scripts"),t("，增加 "),a("code",null,'"prepare": "husky install"')]),a("p",null,[a("img",{src:"/assets/image-20210504120708693.5e11d59c.png",alt:"image-20210504120708693"})])])],-1),ls=a("h4",{id:"配置-lint-staged"},[a("a",{class:"header-anchor",href:"#配置-lint-staged","aria-hidden":"true"},"#"),t(" 配置 lint-staged")],-1),cs=a("p",null,[t("lint-staged 这个工具一般结合 husky 来使用，它可以让 husky 的 "),a("code",null,"hook"),t(" 触发的命令只作用于 "),a("code",null,"git add"),t("那些文件（即 git 暂存区的文件），而不会影响到其他文件。")],-1),ps=a("p",null,"接下来，我们使用 lint-staged 继续优化项目。",-1),us=a("ul",null,[a("li",null,[a("p",null,"安装 lint-staged"),a("div",{class:"language-shell"},[a("pre",null,[a("code",null,[t("$ "),a("span",{class:"token function"},"npm"),t(" i lint-staged -D\n")])])])]),a("li",null,[a("p",null,[t("在 "),a("code",null,"package.json"),t("里增加 lint-staged 配置项")]),a("div",{class:"language-json"},[a("pre",null,[a("code",null,[a("span",{class:"token property"},'"lint-staged"'),a("span",{class:"token operator"},":"),t(),a("span",{class:"token punctuation"},"{"),t("\n  "),a("span",{class:"token property"},'"*.{vue,js,ts}"'),a("span",{class:"token operator"},":"),t(),a("span",{class:"token string"},'"eslint --fix"'),t("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},","),t("\n")])])]),a("p",null,[a("img",{src:"/assets/image-20210504121302298.f0b10d76.png",alt:"image-20210504121302298"})])]),a("li",null,[a("p",null,[t("修改 "),a("code",null,".husky/pre-commit hook"),t(" 的触发命令为："),a("code",null,"npx lint-staged")]),a("p",null,[a("img",{src:"/assets/image-20210504121450870.d62451cf.png",alt:"image-20210504121450870"})])])],-1),rs=a("p",null,"至此，husky 和 lint-staged 组合配置完成。",-1),is=a("h2",{id:"路由自动注册"},[a("a",{class:"header-anchor",href:"#路由自动注册","aria-hidden":"true"},"#"),t(" 路由自动注册")],-1),ks=a("blockquote",null,[a("p",null,"在 src 文件夹下新建 routes 和 api 两文件夹；routes 是集成当前项目的所有路由，api 文件是存放项目的所有接口文件。")],-1),ds=a("ul",null,[a("li",null,[a("p",null,[t("安装 "),a("a",{href:"https://github.com/troygoode/node-require-directory/",target:"_blank",rel:"noopener noreferrer"},[a("code",null,"require-dirctory")]),t("，这个包的作用可以将一个目录下的所有模块文件")]),a("div",{class:"language-shell"},[a("pre",null,[a("code",null,[t("$ "),a("span",{class:"token function"},"npm"),t(" i require-dirctory\n")])])])]),a("li",null,[a("p",null,[t("创建"),a("code",null,"src/api/v1"),t("下创建"),a("code",null,"demo.js"),t("和"),a("code",null,"test.js"),t("文件")]),a("div",{class:"language-js"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// src/api/v1/demo.js"),t("\n"),a("span",{class:"token keyword"},"import"),t(" Router "),a("span",{class:"token keyword"},"from"),t(),a("span",{class:"token string"},"'@koa/router'"),t("\n\n"),a("span",{class:"token keyword"},"const"),t(" router "),a("span",{class:"token operator"},"="),t(),a("span",{class:"token keyword"},"new"),t(),a("span",{class:"token class-name"},"Router"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},"{"),t(" prefix"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token string"},"'/api/v1'"),t(),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),t("\n\nrouter"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"get"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'/demo'"),a("span",{class:"token punctuation"},","),t(),a("span",{class:"token keyword"},"async"),t(),a("span",{class:"token parameter"},"ctx"),t(),a("span",{class:"token operator"},"=>"),t(),a("span",{class:"token punctuation"},"{"),t("\n    ctx"),a("span",{class:"token punctuation"},"."),t("body "),a("span",{class:"token operator"},"="),t(),a("span",{class:"token punctuation"},"{"),t("\n        status"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token number"},"200"),a("span",{class:"token punctuation"},","),t("\n        message"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token string"},"'message'"),a("span",{class:"token punctuation"},","),t("\n        data"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token punctuation"},"{"),t("\n            file"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token string"},"'demo.js'"),a("span",{class:"token punctuation"},","),t("\n            title"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token string"},"'webpack 5 构建node应用'"),a("span",{class:"token punctuation"},","),t("\n            content"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token string"},"'koa + @koa/router + require-dirctory'"),t("\n        "),a("span",{class:"token punctuation"},"}"),t("\n    "),a("span",{class:"token punctuation"},"}"),t("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),t("\n\n"),a("span",{class:"token keyword"},"export"),t(),a("span",{class:"token keyword"},"default"),t(" router\n")])])]),a("div",{class:"language-js"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"//  src/api/v1/test.js"),t("\n"),a("span",{class:"token keyword"},"import"),t(" Router "),a("span",{class:"token keyword"},"from"),t(),a("span",{class:"token string"},"'@koa/router'"),t("\n\n"),a("span",{class:"token keyword"},"const"),t(" router "),a("span",{class:"token operator"},"="),t(),a("span",{class:"token keyword"},"new"),t(),a("span",{class:"token class-name"},"Router"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},"{"),t(" prefix"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token string"},"'/api/v1'"),t(),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),t("\n\nrouter"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"get"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'/test'"),a("span",{class:"token punctuation"},","),t(),a("span",{class:"token keyword"},"async"),t(),a("span",{class:"token parameter"},"ctx"),t(),a("span",{class:"token operator"},"=>"),t(),a("span",{class:"token punctuation"},"{"),t("\n    ctx"),a("span",{class:"token punctuation"},"."),t("body "),a("span",{class:"token operator"},"="),t(),a("span",{class:"token punctuation"},"{"),t("\n        status"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token number"},"200"),a("span",{class:"token punctuation"},","),t("\n        message"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token string"},"'message'"),a("span",{class:"token punctuation"},","),t("\n        data"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token punctuation"},"{"),t("\n            file"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token string"},"'test.js'"),a("span",{class:"token punctuation"},","),t("\n            title"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token string"},"'webpack 5 构建node应用'"),a("span",{class:"token punctuation"},","),t("\n            content"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token string"},"'koa + @koa/router + require-dirctory'"),t("\n        "),a("span",{class:"token punctuation"},"}"),t("\n    "),a("span",{class:"token punctuation"},"}"),t("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),t("\n\n"),a("span",{class:"token keyword"},"export"),t(),a("span",{class:"token keyword"},"default"),t(" router\n")])])])]),a("li",null,[a("p",null,[t("配置"),a("code",null,"src/routes/index.js")]),a("div",{class:"language-js"},[a("pre",null,[a("code",null,[a("span",{class:"token keyword"},"import"),t(" Router "),a("span",{class:"token keyword"},"from"),t(),a("span",{class:"token string"},"'@koa/router'"),t("\n"),a("span",{class:"token keyword"},"import"),t(" requireDirectory "),a("span",{class:"token keyword"},"from"),t(),a("span",{class:"token string"},"'require-directory'"),t("\n\n"),a("span",{class:"token keyword"},"const"),t(" apiDirectory "),a("span",{class:"token operator"},"="),t(),a("span",{class:"token template-string"},[a("span",{class:"token template-punctuation string"},"`"),a("span",{class:"token interpolation"},[a("span",{class:"token interpolation-punctuation punctuation"},"${"),t("process"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"cwd"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token interpolation-punctuation punctuation"},"}")]),a("span",{class:"token string"},"/src/api"),a("span",{class:"token template-punctuation string"},"`")]),t("\n\n"),a("span",{class:"token keyword"},"function"),t(),a("span",{class:"token function"},"initLoadRoutes"),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},"app"),a("span",{class:"token punctuation"},")"),t(),a("span",{class:"token punctuation"},"{"),t("\n    "),a("span",{class:"token function"},"requireDirectory"),a("span",{class:"token punctuation"},"("),t("module"),a("span",{class:"token punctuation"},","),t(" apiDirectory"),a("span",{class:"token punctuation"},","),t(),a("span",{class:"token punctuation"},"{"),t("\n        "),a("span",{class:"token function"},"visit"),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},[a("span",{class:"token punctuation"},"{"),t(),a("span",{class:"token keyword"},"default"),a("span",{class:"token operator"},":"),t(" router "),a("span",{class:"token punctuation"},"}")]),a("span",{class:"token punctuation"},")"),t(),a("span",{class:"token punctuation"},"{"),t("\n            "),a("span",{class:"token keyword"},"if"),t(),a("span",{class:"token punctuation"},"("),t("router "),a("span",{class:"token keyword"},"instanceof"),t(),a("span",{class:"token class-name"},"Router"),a("span",{class:"token punctuation"},")"),t(),a("span",{class:"token punctuation"},"{"),t("\n                app"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"use"),a("span",{class:"token punctuation"},"("),t("router"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"routes"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},")"),t("\n            "),a("span",{class:"token punctuation"},"}"),t("\n        "),a("span",{class:"token punctuation"},"}"),t("\n    "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),t("\n"),a("span",{class:"token punctuation"},"}"),t("\n\n"),a("span",{class:"token keyword"},"export"),t(),a("span",{class:"token keyword"},"default"),t(" initLoadRoutes\n")])])])]),a("li",null,[a("p",null,[t("修改"),a("code",null,"src/app.js"),t("文件")]),a("div",{class:"language-javascript"},[a("pre",null,[a("code",null,[a("span",{class:"token keyword"},"import"),t(" Koa "),a("span",{class:"token keyword"},"from"),t(),a("span",{class:"token string"},"'koa'"),t("\n"),a("span",{class:"token keyword"},"import"),t(" initLoadRoutes "),a("span",{class:"token keyword"},"from"),t(),a("span",{class:"token string"},"'./routes/index'"),t("\n\n"),a("span",{class:"token keyword"},"const"),t(" app "),a("span",{class:"token operator"},"="),t(),a("span",{class:"token keyword"},"new"),t(),a("span",{class:"token class-name"},"Koa"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),t("\n\n"),a("span",{class:"token comment"},"// 在入口文件中执行"),t("\n"),a("span",{class:"token function"},"initLoadRoutes"),a("span",{class:"token punctuation"},"("),t("app"),a("span",{class:"token punctuation"},")"),t("\n\n"),a("span",{class:"token keyword"},"const"),t(" port "),a("span",{class:"token operator"},"="),t(),a("span",{class:"token number"},"3002"),t("\napp"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"listen"),a("span",{class:"token punctuation"},"("),t("port"),a("span",{class:"token punctuation"},","),t(),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),t(),a("span",{class:"token operator"},"=>"),t(" console"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"log"),a("span",{class:"token punctuation"},"("),a("span",{class:"token template-string"},[a("span",{class:"token template-punctuation string"},"`"),a("span",{class:"token string"},"服务启动在"),a("span",{class:"token interpolation"},[a("span",{class:"token interpolation-punctuation punctuation"},"${"),t("port"),a("span",{class:"token interpolation-punctuation punctuation"},"}")]),a("span",{class:"token string"},"端口"),a("span",{class:"token template-punctuation string"},"`")]),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},")"),t("\n")])])])]),a("li",null,[a("p",null,"在 postman 中测试请求如下图"),a("p",null,[a("img",{src:"/assets/image-20210504125524850.db9c0350.png",alt:"image-20210504125524850"})]),a("p",null,[a("img",{src:"/assets/image-20210504125437662.d85cef5d.png",alt:"image-20210504125437662"})]),a("p",null,"到此自动注册路由就大功告成了，后面我们定义接口的时候就用手动一个一个的引入了。")])],-1),gs=a("h2",{id:"配置别名"},[a("a",{class:"header-anchor",href:"#配置别名","aria-hidden":"true"},"#"),t(" 配置别名")],-1),ms=a("p",null,[t("在日常开发中我们引入一些封装好的方法或者模块总是写很长很长的文件路径；比如："),a("code",null,"require('../../../../some/very/deep/module')"),t("、"),a("code",null,"import format from '../../../../utils/format'"),t("，为了告别这种又臭又长的路径我们就可以使用一些解放生产力的方法了（哈哈哈哈，不会偷懒的程序员不是好程序员 🤭）")],-1),fs=a("p",null,[t("配置别名有两种方式，一种是 webpack，另一种是通过"),a("a",{href:"https://www.npmjs.com/package/module-alias",target:"_blank",rel:"noopener noreferrer"},[a("code",null,"module-alias")]),t("包，我这里就使用第二种方法")],-1),bs=a("ul",null,[a("li",null,[a("p",null,"安装依赖"),a("div",{class:"language-shell"},[a("pre",null,[a("code",null,[a("span",{class:"token function"},"npm"),t(" i module-alias\n")])])])]),a("li",null,[a("p",null,[t("在"),a("code",null,"package.json"),t("中添加自定义别名")]),a("div",{class:"language-json"},[a("pre",null,[a("code",null,[a("span",{class:"token property"},'"_moduleAliases"'),a("span",{class:"token operator"},":"),t(),a("span",{class:"token punctuation"},"{"),t("\n    "),a("span",{class:"token property"},'"@"'),a("span",{class:"token operator"},":"),t(),a("span",{class:"token string"},'"./src"'),a("span",{class:"token punctuation"},","),t("\n    "),a("span",{class:"token property"},'"@controller"'),a("span",{class:"token operator"},":"),t(),a("span",{class:"token string"},'"./src/controller"'),t("\n"),a("span",{class:"token punctuation"},"}"),t("\n")])])]),a("p",null,[a("img",{src:"/assets/image-20210504141154503.e04c23c6.png",alt:"image-20210504141154503"})])]),a("li",null,[a("p",null,[t("在入口文件的顶部引入"),a("code",null,"module-alias/register"),t("，也就是在"),a("code",null,"app.js"),t("的顶部引入")]),a("div",{class:"language-javascript"},[a("pre",null,[a("code",null,[a("span",{class:"token function"},"require"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'module-alias/register'"),a("span",{class:"token punctuation"},")"),t("\n")])])]),a("p",null,[a("img",{src:"/assets/image-20210504142411612.b1c72140.png",alt:"image-20210504142411612"})])])],-1),hs=a("blockquote",null,[a("p",null,[t("配置成功后，将"),a("code",null,"/src/api/v1"),t("内的逻辑全部提到"),a("code",null,"src/controller"),t("中，使用别名引入"),a("code",null,"controller"),t("中文件，修改后如下：")])],-1),ws=a("div",{class:"language-javascript"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// src/api/v1/demo.js"),t("\n"),a("span",{class:"token keyword"},"import"),t(" Router "),a("span",{class:"token keyword"},"from"),t(),a("span",{class:"token string"},"'@koa/router'"),t("\n"),a("span",{class:"token keyword"},"import"),t(" DemoController "),a("span",{class:"token keyword"},"from"),t(),a("span",{class:"token string"},"'@controller/demo/'"),t("\n\n"),a("span",{class:"token keyword"},"const"),t(" router "),a("span",{class:"token operator"},"="),t(),a("span",{class:"token keyword"},"new"),t(),a("span",{class:"token class-name"},"Router"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},"{"),t(" prefix"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token string"},"'/api/v1'"),t(),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),t("\n\nrouter"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"get"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'/demo'"),a("span",{class:"token punctuation"},","),t(" DemoController"),a("span",{class:"token punctuation"},"."),t("demo"),a("span",{class:"token punctuation"},")"),t("\n\n"),a("span",{class:"token keyword"},"export"),t(),a("span",{class:"token keyword"},"default"),t(" router\n")])])],-1),ys=a("div",{class:"language-javascript"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// src/api/v1/test.js"),t("\n"),a("span",{class:"token keyword"},"import"),t(" Router "),a("span",{class:"token keyword"},"from"),t(),a("span",{class:"token string"},"'@koa/router'"),t("\n"),a("span",{class:"token keyword"},"import"),t(" TestController "),a("span",{class:"token keyword"},"from"),t(),a("span",{class:"token string"},"'@controller/test'"),t("\n\n"),a("span",{class:"token keyword"},"const"),t(" router "),a("span",{class:"token operator"},"="),t(),a("span",{class:"token keyword"},"new"),t(),a("span",{class:"token class-name"},"Router"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},"{"),t(" prefix"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token string"},"'/api/v1'"),t(),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),t("\n\nrouter"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"get"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'/test'"),a("span",{class:"token punctuation"},","),t(" TestController"),a("span",{class:"token punctuation"},"."),t("test"),a("span",{class:"token punctuation"},")"),t("\n\n"),a("span",{class:"token keyword"},"export"),t(),a("span",{class:"token keyword"},"default"),t(" router\n")])])],-1),vs=a("div",{class:"language-javascript"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// src/controller/v1/demo.js"),t("\n"),a("span",{class:"token keyword"},"class"),t(),a("span",{class:"token class-name"},"DemoController"),t(),a("span",{class:"token punctuation"},"{"),t("\n    "),a("span",{class:"token function"},"constructor"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),t(),a("span",{class:"token punctuation"},"{"),a("span",{class:"token punctuation"},"}"),t("\n\n    "),a("span",{class:"token keyword"},"async"),t(),a("span",{class:"token function"},"demo"),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},"ctx"),a("span",{class:"token punctuation"},")"),t(),a("span",{class:"token punctuation"},"{"),t("\n        ctx"),a("span",{class:"token punctuation"},"."),t("body "),a("span",{class:"token operator"},"="),t(),a("span",{class:"token punctuation"},"{"),t("\n            status"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token number"},"200"),a("span",{class:"token punctuation"},","),t("\n            message"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token string"},"'message'"),a("span",{class:"token punctuation"},","),t("\n            data"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token punctuation"},"{"),t("\n                file"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token string"},"'test.js'"),a("span",{class:"token punctuation"},","),t("\n                title"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token string"},"'webpack 5 构建node应用'"),a("span",{class:"token punctuation"},","),t("\n                content"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token string"},"'koa + @koa/router + require-dirctory'"),t("\n            "),a("span",{class:"token punctuation"},"}"),t("\n        "),a("span",{class:"token punctuation"},"}"),t("\n    "),a("span",{class:"token punctuation"},"}"),t("\n"),a("span",{class:"token punctuation"},"}"),t("\n\n"),a("span",{class:"token keyword"},"export"),t(),a("span",{class:"token keyword"},"default"),t(),a("span",{class:"token keyword"},"new"),t(),a("span",{class:"token class-name"},"DemoController"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),t("\n")])])],-1),js=a("div",{class:"language-javascript"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// src/controller/v1/test.js"),t("\n"),a("span",{class:"token keyword"},"class"),t(),a("span",{class:"token class-name"},"TestController"),t(),a("span",{class:"token punctuation"},"{"),t("\n    "),a("span",{class:"token function"},"constructor"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),t(),a("span",{class:"token punctuation"},"{"),a("span",{class:"token punctuation"},"}"),t("\n\n    "),a("span",{class:"token keyword"},"async"),t(),a("span",{class:"token function"},"test"),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},"ctx"),a("span",{class:"token punctuation"},")"),t(),a("span",{class:"token punctuation"},"{"),t("\n        ctx"),a("span",{class:"token punctuation"},"."),t("body "),a("span",{class:"token operator"},"="),t(),a("span",{class:"token punctuation"},"{"),t("\n            status"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token number"},"200"),a("span",{class:"token punctuation"},","),t("\n            message"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token string"},"'message'"),a("span",{class:"token punctuation"},","),t("\n            data"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token punctuation"},"{"),t("\n                file"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token string"},"'test.js'"),a("span",{class:"token punctuation"},","),t("\n                title"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token string"},"'webpack 5 构建node应用'"),a("span",{class:"token punctuation"},","),t("\n                content"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token string"},"'koa + @koa/router + require-dirctory'"),t("\n            "),a("span",{class:"token punctuation"},"}"),t("\n        "),a("span",{class:"token punctuation"},"}"),t("\n    "),a("span",{class:"token punctuation"},"}"),t("\n"),a("span",{class:"token punctuation"},"}"),t("\n\n"),a("span",{class:"token keyword"},"export"),t(),a("span",{class:"token keyword"},"default"),t(),a("span",{class:"token keyword"},"new"),t(),a("span",{class:"token class-name"},"TestController"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),t("\n")])])],-1),xs=a("ul",null,[a("li",null,[a("p",null,"postman 中测试接口"),a("p",null,[a("img",{src:"/assets/image-20210504143159248.40707dd9.png",alt:"image-20210504143159248"})]),a("p",null,[a("img",{src:"/assets/image-20210504143225351.473355ca.png",alt:"image-20210504143225351"})])])],-1),Es=a("p",null,"commit 时 lint-staged 没有通过：",-1),qs=a("p",null,[a("img",{src:"/assets/image-20210504152231237.1fa8c365.png",alt:"image-20210504152231237"})],-1),Ss=a("blockquote",null,[a("p",null,[t("上述问题是 eslint 发现"),a("code",null,"@controller/*"),t("开头的在 node_modules 中没有找到，所以配置 eslint 就好了：")]),a("div",{class:"language-js"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// src/eslintrc.js"),t("\nmodule"),a("span",{class:"token punctuation"},"."),t("exports "),a("span",{class:"token operator"},"="),t(),a("span",{class:"token punctuation"},"{"),t("\n    "),a("span",{class:"token comment"},"//..."),t("\n    rules"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token punctuation"},"{"),t("\n        "),a("span",{class:"token string"},"'import/no-unresolved'"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token punctuation"},"["),a("span",{class:"token number"},"2"),a("span",{class:"token punctuation"},","),t(),a("span",{class:"token punctuation"},"{"),t(" ignore"),a("span",{class:"token operator"},":"),t(),a("span",{class:"token punctuation"},"["),a("span",{class:"token string"},"'^@/'"),a("span",{class:"token punctuation"},","),t(),a("span",{class:"token string"},"'@controller'"),a("span",{class:"token punctuation"},"]"),t(),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},"]"),t(),a("span",{class:"token comment"},"// @和@controller 是设置的路径别名"),t("\n    "),a("span",{class:"token punctuation"},"}"),t("\n"),a("span",{class:"token punctuation"},"}"),t("\n")])])])],-1),Cs=a("p",null,[a("img",{src:"/assets/image-20210504154049823.bc622450.png",alt:"image-20210504154049823"})],-1),_s=a("blockquote",null,[a("p",null,[t("这个问题是由于"),a("code",null,"constructor"),t("构造函数为空引起的，在"),a("code",null,"eslintrc.js"),t("添加配置即可：'no-empty-function': ['error', { allow: ['constructors'] }]")])],-1),Ds=a("p",null,[t("完整代码见："),a("a",{href:"https://github.com/big-front-end/webpack5-node",target:"_blank",rel:"noopener noreferrer"},"GitHub")],-1);o.render=function(a,t,e,o,Ps,Ls){return n(),s("div",null,[l,c,p,u,r,i,k,d,g,m,f,b,h,w,y,v,j,x,E,q,S,C,_,D,P,L,$,N,W,T,R,V,O,J,A,G,H,z,K,I,M,Q,U,F,X,Y,B,Z,nn,sn,an,tn,en,on,ln,cn,pn,un,rn,kn,dn,gn,mn,fn,bn,hn,wn,yn,vn,jn,xn,En,qn,Sn,Cn,_n,Dn,Pn,Ln,$n,Nn,Wn,Tn,Rn,Vn,On,Jn,An,Gn,Hn,zn,Kn,In,Mn,Qn,Un,Fn,Xn,Yn,Bn,Zn,ns,ss,as,ts,es,os,ls,cs,ps,us,rs,is,ks,ds,gs,ms,fs,bs,hs,ws,ys,vs,js,xs,Es,qs,Ss,Cs,_s,Ds])};export default o;export{e as __pageData};
