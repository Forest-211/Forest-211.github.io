<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>认识 MongoDB | Forest</title>
    <meta name="description" content="笔记记录、阅读">
    <link rel="stylesheet" href="/docs/assets/style.abb680c9.css">
    <link rel="modulepreload" href="/docs/assets/Home.fbf65f2b.js">
    <link rel="modulepreload" href="/docs/assets/app.1507091b.js">
    <link rel="modulepreload" href="/docs/assets/database_mongodb_01-MongoDB.md.20c42fd4.lean.js">
    <link rel="modulepreload" href="/docs/assets/app.1507091b.js">
    <meta name="twitter:title" content="认识 MongoDB | Forest">
    <meta property="og:title" content="认识 MongoDB | Forest">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><header class="nav-bar" data-v-7161a24b><div class="sidebar-button" data-v-7161a24b><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/docs/" aria-label="Forest, back to home" data-v-7161a24b data-v-4a583abe><!----> Forest</a><div class="flex-grow" data-v-7161a24b></div><div class="nav" data-v-7161a24b><nav class="nav-links" data-v-7161a24b data-v-15acbf05><!--[--><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-641633f9><a class="item" href="/docs/" data-v-641633f9>首页 <!----></a></div></div><div class="item" data-v-15acbf05><div class="nav-dropdown-link" data-v-15acbf05 data-v-90f2c308><button class="button" data-v-90f2c308><span class="button-text" data-v-90f2c308>前端</span><span class="right button-arrow" data-v-90f2c308></span></button><ul class="dialog" data-v-90f2c308><!--[--><li class="dialog-item" data-v-90f2c308><div class="nav-dropdown-link-item" data-v-90f2c308 data-v-57d767ef><a class="item" href="/docs/front-end/js/" data-v-57d767ef><span class="arrow" data-v-57d767ef></span><span class="text" data-v-57d767ef>javascript</span><span class="icon" data-v-57d767ef><!----></span></a></div></li><li class="dialog-item" data-v-90f2c308><div class="nav-dropdown-link-item" data-v-90f2c308 data-v-57d767ef><a class="item" href="/docs/front-end/vue/" data-v-57d767ef><span class="arrow" data-v-57d767ef></span><span class="text" data-v-57d767ef>vue</span><span class="icon" data-v-57d767ef><!----></span></a></div></li><li class="dialog-item" data-v-90f2c308><div class="nav-dropdown-link-item" data-v-90f2c308 data-v-57d767ef><a class="item" href="/docs/front-end/react/" data-v-57d767ef><span class="arrow" data-v-57d767ef></span><span class="text" data-v-57d767ef>react</span><span class="icon" data-v-57d767ef><!----></span></a></div></li><li class="dialog-item" data-v-90f2c308><div class="nav-dropdown-link-item" data-v-90f2c308 data-v-57d767ef><a class="item" href="/docs/front-end/typescript/" data-v-57d767ef><span class="arrow" data-v-57d767ef></span><span class="text" data-v-57d767ef>Ts</span><span class="icon" data-v-57d767ef><!----></span></a></div></li><li class="dialog-item" data-v-90f2c308><div class="nav-dropdown-link-item" data-v-90f2c308 data-v-57d767ef><a class="item" href="/docs/front-end/node/" data-v-57d767ef><span class="arrow" data-v-57d767ef></span><span class="text" data-v-57d767ef>node</span><span class="icon" data-v-57d767ef><!----></span></a></div></li><li class="dialog-item" data-v-90f2c308><div class="nav-dropdown-link-item" data-v-90f2c308 data-v-57d767ef><a class="item" href="/docs/front-end/nest/" data-v-57d767ef><span class="arrow" data-v-57d767ef></span><span class="text" data-v-57d767ef>nest</span><span class="icon" data-v-57d767ef><!----></span></a></div></li><li class="dialog-item" data-v-90f2c308><div class="nav-dropdown-link-item" data-v-90f2c308 data-v-57d767ef><a class="item" href="/docs/front-end/react-native/" data-v-57d767ef><span class="arrow" data-v-57d767ef></span><span class="text" data-v-57d767ef>react-native</span><span class="icon" data-v-57d767ef><!----></span></a></div></li><!--]--></ul></div></div><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-641633f9><a class="item" href="/docs/go/" data-v-641633f9>Go <!----></a></div></div><div class="item" data-v-15acbf05><div class="nav-dropdown-link" data-v-15acbf05 data-v-90f2c308><button class="button" data-v-90f2c308><span class="button-text" data-v-90f2c308>工具</span><span class="right button-arrow" data-v-90f2c308></span></button><ul class="dialog" data-v-90f2c308><!--[--><li class="dialog-item" data-v-90f2c308><div class="nav-dropdown-link-item" data-v-90f2c308 data-v-57d767ef><a class="item" href="/docs/utils/git/" data-v-57d767ef><span class="arrow" data-v-57d767ef></span><span class="text" data-v-57d767ef>Git</span><span class="icon" data-v-57d767ef><!----></span></a></div></li><li class="dialog-item" data-v-90f2c308><div class="nav-dropdown-link-item" data-v-90f2c308 data-v-57d767ef><a class="item" href="/docs/utils/docker/" data-v-57d767ef><span class="arrow" data-v-57d767ef></span><span class="text" data-v-57d767ef>Docker</span><span class="icon" data-v-57d767ef><!----></span></a></div></li><!--]--></ul></div></div><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-641633f9><a class="item" href="/docs/other/" data-v-641633f9>其他 <!----></a></div></div><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-641633f9><a class="item isExternal" href="https://github.com/Forest-211" target="_blank" rel="noopener noreferrer" data-v-641633f9>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-641633f9><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><!--]--><!----><!----></nav></div><!--[--><!--]--></header><aside class="sidebar" data-v-6b49cdcd><nav class="nav-links nav" data-v-6b49cdcd data-v-15acbf05><!--[--><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-641633f9><a class="item" href="/docs/" data-v-641633f9>首页 <!----></a></div></div><div class="item" data-v-15acbf05><div class="nav-dropdown-link" data-v-15acbf05 data-v-90f2c308><button class="button" data-v-90f2c308><span class="button-text" data-v-90f2c308>前端</span><span class="right button-arrow" data-v-90f2c308></span></button><ul class="dialog" data-v-90f2c308><!--[--><li class="dialog-item" data-v-90f2c308><div class="nav-dropdown-link-item" data-v-90f2c308 data-v-57d767ef><a class="item" href="/docs/front-end/js/" data-v-57d767ef><span class="arrow" data-v-57d767ef></span><span class="text" data-v-57d767ef>javascript</span><span class="icon" data-v-57d767ef><!----></span></a></div></li><li class="dialog-item" data-v-90f2c308><div class="nav-dropdown-link-item" data-v-90f2c308 data-v-57d767ef><a class="item" href="/docs/front-end/vue/" data-v-57d767ef><span class="arrow" data-v-57d767ef></span><span class="text" data-v-57d767ef>vue</span><span class="icon" data-v-57d767ef><!----></span></a></div></li><li class="dialog-item" data-v-90f2c308><div class="nav-dropdown-link-item" data-v-90f2c308 data-v-57d767ef><a class="item" href="/docs/front-end/react/" data-v-57d767ef><span class="arrow" data-v-57d767ef></span><span class="text" data-v-57d767ef>react</span><span class="icon" data-v-57d767ef><!----></span></a></div></li><li class="dialog-item" data-v-90f2c308><div class="nav-dropdown-link-item" data-v-90f2c308 data-v-57d767ef><a class="item" href="/docs/front-end/typescript/" data-v-57d767ef><span class="arrow" data-v-57d767ef></span><span class="text" data-v-57d767ef>Ts</span><span class="icon" data-v-57d767ef><!----></span></a></div></li><li class="dialog-item" data-v-90f2c308><div class="nav-dropdown-link-item" data-v-90f2c308 data-v-57d767ef><a class="item" href="/docs/front-end/node/" data-v-57d767ef><span class="arrow" data-v-57d767ef></span><span class="text" data-v-57d767ef>node</span><span class="icon" data-v-57d767ef><!----></span></a></div></li><li class="dialog-item" data-v-90f2c308><div class="nav-dropdown-link-item" data-v-90f2c308 data-v-57d767ef><a class="item" href="/docs/front-end/nest/" data-v-57d767ef><span class="arrow" data-v-57d767ef></span><span class="text" data-v-57d767ef>nest</span><span class="icon" data-v-57d767ef><!----></span></a></div></li><li class="dialog-item" data-v-90f2c308><div class="nav-dropdown-link-item" data-v-90f2c308 data-v-57d767ef><a class="item" href="/docs/front-end/react-native/" data-v-57d767ef><span class="arrow" data-v-57d767ef></span><span class="text" data-v-57d767ef>react-native</span><span class="icon" data-v-57d767ef><!----></span></a></div></li><!--]--></ul></div></div><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-641633f9><a class="item" href="/docs/go/" data-v-641633f9>Go <!----></a></div></div><div class="item" data-v-15acbf05><div class="nav-dropdown-link" data-v-15acbf05 data-v-90f2c308><button class="button" data-v-90f2c308><span class="button-text" data-v-90f2c308>工具</span><span class="right button-arrow" data-v-90f2c308></span></button><ul class="dialog" data-v-90f2c308><!--[--><li class="dialog-item" data-v-90f2c308><div class="nav-dropdown-link-item" data-v-90f2c308 data-v-57d767ef><a class="item" href="/docs/utils/git/" data-v-57d767ef><span class="arrow" data-v-57d767ef></span><span class="text" data-v-57d767ef>Git</span><span class="icon" data-v-57d767ef><!----></span></a></div></li><li class="dialog-item" data-v-90f2c308><div class="nav-dropdown-link-item" data-v-90f2c308 data-v-57d767ef><a class="item" href="/docs/utils/docker/" data-v-57d767ef><span class="arrow" data-v-57d767ef></span><span class="text" data-v-57d767ef>Docker</span><span class="icon" data-v-57d767ef><!----></span></a></div></li><!--]--></ul></div></div><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-641633f9><a class="item" href="/docs/other/" data-v-641633f9>其他 <!----></a></div></div><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-641633f9><a class="item isExternal" href="https://github.com/Forest-211" target="_blank" rel="noopener noreferrer" data-v-641633f9>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-641633f9><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><!--]--><!----><!----></nav><!--[--><!--]--><ul class="sidebar-links" data-v-6b49cdcd><!--[--><li class="sidebar-link"><a class="sidebar-link-item" href="#什么是-mongodb？">什么是 MongoDB？</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#为什么叫文档数据库">为什么叫文档数据库</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#谁开发的-mongodb？">谁开发的 MongoDB？</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#主要用途">主要用途</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#主要特点">主要特点</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#mongodb-是免费的吗？">MongoDB 是免费的吗？</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#mongodb-与关系型数据库">MongoDB 与关系型数据库</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#mongodb-的优势及特点">MongoDB 的优势及特点</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#优势">优势</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#安装-mongodb-官网">安装 MongoDB 官网</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#mongodb-基本操作">MongoDB 基本操作</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#连接数据库">连接数据库</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#查看已有的数据库">查看已有的数据库</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#查看当前数据库">查看当前数据库</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#创建数据库或者切换数据库">创建数据库或者切换数据库</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#查看当前数据库已有文档（表）">查看当前数据库已有文档（表）</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#添加数据">添加数据</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#查看文档模型中的数据">查看文档模型中的数据</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#删除数据">删除数据</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#更新数据">更新数据</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#删除表">删除表</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#删除数据库-dropdatabase">删除数据库 dropDatabase</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#备份与恢复">备份与恢复</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#查询">查询</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#聚合查询">聚合查询</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#聚合运算的使用场景">聚合运算的使用场景</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#mql-常用步骤与-sql-对比">MQL 常用步骤与 SQL 对比</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#mql-特有步骤-unwind">MQL 特有步骤$unwind</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#mql-特有的-bucket">MQL 特有的$bucket</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#mql-特有的-facet">MQL 特有的$facet</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#复制集">复制集</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#复制集的作用">复制集的作用</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#典型复制集结构">典型复制集结构</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#数据是如何复制的？">数据是如何复制的？</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#选举时如何完成故障恢复的？">选举时如何完成故障恢复的？</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#影响选举的因素">影响选举的因素</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#常见选项">常见选项</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#复制集注意事项">复制集注意事项</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#atlas-mongodb-公有云托管服务">Atlas-MongoDB 公有云托管服务</a><!----></li></ul></li><!--]--></ul><!--[--><!--]--></aside><!-- TODO: make this button accessible --><div class="sidebar-mask"></div><main class="page" data-v-7eddb2c4><div class="container" data-v-7eddb2c4><!--[--><!--]--><div style="position:relative;" class="content" data-v-7eddb2c4><div><h1 id="认识-mongodb"><a class="header-anchor" href="#认识-mongodb" aria-hidden="true">#</a> 认识 MongoDB</h1><h2 id="什么是-mongodb？"><a class="header-anchor" href="#什么是-mongodb？" aria-hidden="true">#</a> 什么是 MongoDB？</h2><p>一个以 json 为数据模型的文档数据库</p><h2 id="为什么叫文档数据库"><a class="header-anchor" href="#为什么叫文档数据库" aria-hidden="true">#</a> 为什么叫文档数据库</h2><p>文档来自于 &quot;JSON Document&quot;，并非我们理解的 PDF、word 文档</p><h2 id="谁开发的-mongodb？"><a class="header-anchor" href="#谁开发的-mongodb？" aria-hidden="true">#</a> 谁开发的 MongoDB？</h2><p>上市公司 MongoDB Inc，总部位于美国纽约</p><h2 id="主要用途"><a class="header-anchor" href="#主要用途" aria-hidden="true">#</a> 主要用途</h2><p>应用数据库，类似于 Oracle、MySQL 海量数据处理，数据平台</p><h2 id="主要特点"><a class="header-anchor" href="#主要特点" aria-hidden="true">#</a> 主要特点</h2><ul><li>建模为可选</li><li>JSON 数据模型比较适合开发</li><li>横向扩展可以支撑很大数据量和并发</li><li>易扩展、高性能、高可用</li><li>较容易映射复杂数据（key-value）</li><li>无事务特性要求（ACID 特性） <ul><li>A： 原则性</li><li>C： 一致性</li><li>I： 独立性</li><li>D：持久性</li></ul></li></ul><h2 id="mongodb-是免费的吗？"><a class="header-anchor" href="#mongodb-是免费的吗？" aria-hidden="true">#</a> MongoDB 是免费的吗？</h2><ul><li>MongoDB 有两个发布版本：社区版和企业版</li><li>社区办基于 SSPL，一种和 AGPL 基本类似的开源协议</li><li>企业版是基于商业协议，需要付费使用</li></ul><h2 id="mongodb-与关系型数据库"><a class="header-anchor" href="#mongodb-与关系型数据库" aria-hidden="true">#</a> MongoDB 与关系型数据库</h2><p><img src="/docs/assets/1616208952573-8ffd239b-c069-4649-bbd1-06111aa15486.1c8eabe0.png" alt="image.png"></p><h2 id="mongodb-的优势及特点"><a class="header-anchor" href="#mongodb-的优势及特点" aria-hidden="true">#</a> MongoDB 的优势及特点</h2><h3 id="优势"><a class="header-anchor" href="#优势" aria-hidden="true">#</a> 优势</h3><ul><li>面向开发者的医用 + 高效数据库</li></ul><p><img src="/docs/assets/1616209245470-ff96a30f-5e85-4c2e-be81-a4eaccb87d39.ce35296a.png" alt="image.png"></p><ul><li><p>一目了然的对象模型</p></li><li><ul><li>文档模型与数据库中的文档一一对应</li></ul></li></ul><p><img src="/docs/assets/1616209303962-2bcb6794-2ce8-41ab-a93b-4ece07b2b620.d0cc6111.png" alt="image.png"></p><ul><li>灵活：快速响应业务变化 <ul><li>多形性：同一集合可以包含不同字段(类型)的文档对象</li><li>动态性：线上修改数据模式，修改时应用与数据库均无需下线</li><li>数据治理：支持使用 JSON Schema 来规范数据模式，在保障模式灵活动态的前提下，提供数据治理能力</li></ul></li></ul><p><img src="/docs/assets/1616209385224-53ab457b-5dc5-4981-b227-71024ecf19b9.24eb5a0a.png" alt="image.png"></p><ul><li>快速：最简单快速的开发方式；JSON 模型之快速特性：</li><li>数据库引擎只需要在一个存储区读写</li><li>反范式、无关联的组织极大优化查询速度</li><li>程序 API 自然开发快速</li></ul><p><img src="/docs/assets/1616209499188-822e92a3-ec8f-4391-8713-b84b7cc28234.9775cf8f.png" alt="image.png"></p><ul><li><p>原生的高可用和横向扩展能力</p></li><li><ul><li>Replica Set-2 to 50 个成员</li><li>自恢复</li><li>多中心容灾能力</li><li>滚动服务 - 最小化服务终端</li></ul></li></ul><p><img src="/docs/assets/1616210262140-97cfc44e-e4e2-4e05-b4af-daab89cc325c.4904d47a.png" alt="image.png"></p><ul><li><p>横向扩展能力</p></li><li><ul><li>需要的时候无缝扩展</li><li>应用全透明</li><li>多种数据分布策略</li><li>轻松支持 TB-PB 数量级</li></ul></li></ul><p><img src="/docs/assets/1616210618591-9736183e-cfae-4dc6-aa45-e266b3b3fda3.977aef26.png" alt="image.png"></p><h2 id="安装-mongodb-官网"><a class="header-anchor" href="#安装-mongodb-官网" aria-hidden="true">#</a> 安装 MongoDB <a href="https://www.mongodb.com/try" target="_blank" rel="noopener noreferrer">官网</a></h2><h2 id="mongodb-基本操作"><a class="header-anchor" href="#mongodb-基本操作" aria-hidden="true">#</a> MongoDB 基本操作</h2><h3 id="连接数据库"><a class="header-anchor" href="#连接数据库" aria-hidden="true">#</a> 连接数据库</h3><ul><li>连接本地数据库</li></ul><blockquote><p>Tips：</p><p>windows 系统的话，本地的数据库必须添加环境变量，否则 mongod 或者 mongo 服务找不到</p></blockquote><div class="language-shell"><pre><code>$ mongod <span class="token operator">&lt;</span>保存数据的文件夹路径<span class="token operator">&gt;</span> --port <span class="token number">27017</span>
</code></pre></div><h3 id="查看已有的数据库"><a class="header-anchor" href="#查看已有的数据库" aria-hidden="true">#</a> 查看已有的数据库</h3><div class="language-shell"><pre><code>show dbs
</code></pre></div><p><img src="/docs/assets/1616219506066-751483e7-c7db-4e6e-a0cc-24d524ec707c.4a2c6e4d.png" alt="image.png"></p><h3 id="查看当前数据库"><a class="header-anchor" href="#查看当前数据库" aria-hidden="true">#</a> 查看当前数据库</h3><div class="language-shell"><pre><code>db
</code></pre></div><p><img src="data:image/png;base64,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" alt="image.png"></p><h3 id="创建数据库或者切换数据库"><a class="header-anchor" href="#创建数据库或者切换数据库" aria-hidden="true">#</a> 创建数据库或者切换数据库</h3><div class="language-shell"><pre><code>// 如果有这个数据库的话就是切换，没有的话就是创建
use <span class="token operator">&lt;</span>数据库名<span class="token operator">&gt;</span>
</code></pre></div><p><img src="/docs/assets/1616219430156-ce874a39-bac3-46c2-96be-18efb6eb9453.7a4a84e4.png" alt="image.png"></p><h3 id="查看当前数据库已有文档（表）"><a class="header-anchor" href="#查看当前数据库已有文档（表）" aria-hidden="true">#</a> 查看当前数据库已有文档（表）</h3><div class="language-shell"><pre><code>show collections
</code></pre></div><p><img src="data:image/png;base64,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" alt="image.png"></p><h3 id="添加数据"><a class="header-anchor" href="#添加数据" aria-hidden="true">#</a> 添加数据</h3><p>语法：</p><div class="language-shell"><pre><code>// 添加单条数据
db.<span class="token operator">&lt;</span>collection<span class="token operator">&gt;</span>.insertOne<span class="token punctuation">(</span><span class="token operator">&lt;</span>JSON<span class="token operator">&gt;</span><span class="token punctuation">)</span>

// 添加多条数据
db.<span class="token operator">&lt;</span>collection<span class="token operator">&gt;</span>.insertMany<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">&lt;</span>JSON <span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>, <span class="token operator">&lt;</span>JSON <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>, <span class="token punctuation">..</span>., <span class="token operator">&lt;</span>JSON n<span class="token operator">&gt;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>添加一条数据</li></ul><p><img src="/docs/assets/1616219864202-be76b7bb-461a-486f-9376-7ed933e051d9.66f84c2f.png" alt="image.png"></p><ul><li>添加多条数据</li></ul><p><img src="/docs/assets/1616220248599-465e1c62-1403-4e77-b00f-d0b79c4acd30.2c3adcf7.png" alt="image.png"></p><h3 id="查看文档模型中的数据"><a class="header-anchor" href="#查看文档模型中的数据" aria-hidden="true">#</a> 查看文档模型中的数据</h3><blockquote><ul><li>find()是 MongoDB 数据库查询数据的基本指令，相当于 SQL 中的 SELECT</li><li>find()返回游标</li></ul></blockquote><ul><li><p>查询指定文档模型中的全部数据</p><div class="language-shell"><pre><code>db.<span class="token operator">&lt;</span>文档模型的名称<span class="token operator">&gt;</span>.find<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p><img src="/docs/assets/1616220403969-bc2640de-55d2-464c-96d0-684d7a3e1925.6202e70f.png" alt="image.png"></p></li><li><p>单条件查询</p><blockquote><p>查询一条 name 为 apple 的数据</p></blockquote><p><img src="/docs/assets/1616220964687-67cb91fd-fb76-49ff-bfd8-07f99b4d0816.5d038771.png" alt="image.png"></p></li><li><p>多条件 and 查询</p><blockquote><p>查询一条 name 为 pear 和 weight 为 400 的数据</p></blockquote><p><img src="/docs/assets/1616221382117-14af946d-8c98-484f-aca9-f3e0c71a1b3d.873ca0f3.png" alt="image.png"></p></li><li><p>and 的另一种形式查询</p><p><img src="/docs/assets/1616221586954-a8348828-3671-4254-969f-782c5b053575.64376866.png" alt="image.png"></p></li><li><p>多条件 or 查询</p><blockquote><p>查询 name 为 apple 或者 weight 为 400 的数据</p></blockquote><p><img src="/docs/assets/1616221660514-eda617db-5370-434a-968a-385d905f44df.91464524.png" alt="image.png"></p></li><li><p>按正则表达式查找</p><blockquote><p>查找所有 name 中以 a 开头的所有数据</p></blockquote><p><img src="/docs/assets/1616221971504-fe951f06-5127-4b62-987c-18564806fdc1.f8ab5e89.png" alt="image.png"></p></li></ul><p>查询条件对照表</p><table><thead><tr><th><strong><em>逻辑运算符</em></strong></th><th><strong><em>MongoDB 中的写法</em></strong></th></tr></thead><tbody><tr><td>a 等于 1</td><td>{ a : 1 }</td></tr><tr><td>a 不等于 1</td><td>{ a : { $ne : 1 } }</td></tr><tr><td>a 大于 1</td><td>{ a : { $gt: 1 } }</td></tr><tr><td>a 小于 1</td><td>{ a : { $lt : 1 } }</td></tr><tr><td>a 大于等于 1</td><td>{ a : { $gte : 1 } }</td></tr><tr><td>a 小于等于 1</td><td>{ a : { $lte : 1 } }</td></tr><tr><td>a 等于 1 和 b 等于 1</td><td>{ a : 1, b : 1 }或者{ $and: [{ a : 1 }, { b : 1 }] }</td></tr><tr><td>a 等于 1 或者 b 等于 1</td><td>{ $or: [{ a : 1 }, { b : 1 }] }</td></tr><tr><td>判断 a 字段不存在</td><td>{ a : { $exists : false } }</td></tr><tr><td>a 包含 1, 2, 3</td><td>{ a : { $in : [1, 2, 3] } }</td></tr></tbody></table><h4 id="查询的逻辑运算符"><a class="header-anchor" href="#查询的逻辑运算符" aria-hidden="true">#</a> 查询的逻辑运算符</h4><ul><li>$lt 存在并小于</li><li>$lte 存在并小于等于</li><li>$gt 存在并大于</li><li>$gte 存在并大于等于</li><li>$ne 不存在或者存在但不等于</li><li>$in 存在并在指定数组中</li><li>$nin 不存在或者不在指定数组中</li><li>$or 匹配两个或多个条件中的一个</li><li>$and 匹配全部条件</li></ul><h4 id="find-搜索子文档"><a class="header-anchor" href="#find-搜索子文档" aria-hidden="true">#</a> find 搜索子文档</h4><p>find 支持使用“field.sub_field”的形式查询子文档。假设有一个文档：</p><div class="language-js"><pre><code>db<span class="token punctuation">.</span>fruit<span class="token punctuation">.</span><span class="token function">insertOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">&#39;apple&#39;</span><span class="token punctuation">,</span>
    from<span class="token operator">:</span> <span class="token punctuation">{</span>
        country<span class="token operator">:</span> <span class="token string">&#39;China&#39;</span><span class="token punctuation">,</span>
        province<span class="token operator">:</span> <span class="token string">&#39;Chengdu&#39;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

db<span class="token punctuation">.</span>fruit<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string">&#39;fruit.country&#39;</span><span class="token operator">:</span> <span class="token string">&#39;China&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
db<span class="token punctuation">.</span>fruit<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> from<span class="token operator">:</span> <span class="token punctuation">{</span> country<span class="token operator">:</span> <span class="token string">&#39;China&#39;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 等同于上一行语句</span>
</code></pre></div><h4 id="使用-find-搜索数组"><a class="header-anchor" href="#使用-find-搜索数组" aria-hidden="true">#</a> 使用 find 搜索数组</h4><ul><li>find 支持对数组中的元素进行搜索，假设有一个文档</li></ul><div class="language-js"><pre><code>db<span class="token punctuation">.</span>fruit<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&#39;Apple&#39;</span><span class="token punctuation">,</span> color<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;red&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;green&#39;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&#39;mango&#39;</span><span class="token punctuation">,</span> color<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;yellow&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;green&#39;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment">// 查询</span>
db<span class="token punctuation">.</span>fruit<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> color<span class="token operator">:</span> <span class="token string">&#39;red&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 查询颜色为&#39;red&#39;的所有数据</span>

db<span class="token punctuation">.</span>fruit<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> $or<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> color<span class="token operator">:</span> <span class="token string">&#39;red&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> color<span class="token operator">:</span> green <span class="token punctuation">}</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 查询颜色为&#39;red&#39;或者为&#39;green&#39;的所有数据</span>

db<span class="token punctuation">.</span>movies<span class="token punctuation">.</span><span class="token function">insertOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    title<span class="token operator">:</span> <span class="token string">&#39;Raiders of the Lost Ark&#39;</span><span class="token punctuation">,</span>
    filming_locations<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span> city<span class="token operator">:</span> <span class="token string">&#39;Los Angeles&#39;</span><span class="token punctuation">,</span> state<span class="token operator">:</span> <span class="token string">&#39;CA&#39;</span><span class="token punctuation">,</span> country<span class="token operator">:</span> <span class="token string">&#39;USA&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> city<span class="token operator">:</span> <span class="token string">&#39;Rome&#39;</span><span class="token punctuation">,</span> state<span class="token operator">:</span> <span class="token string">&#39;Lazio&#39;</span><span class="token punctuation">,</span> country<span class="token operator">:</span> <span class="token string">&#39;Italy&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> city<span class="token operator">:</span> <span class="token string">&#39;Florence&#39;</span><span class="token punctuation">,</span> state<span class="token operator">:</span> <span class="token string">&#39;SC&#39;</span><span class="token punctuation">,</span> country<span class="token operator">:</span> <span class="token string">&#39;USA&#39;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 查询城市为Rome的记录</span>
db<span class="token punctuation">.</span>movies<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string">&#39;filming_locations.city&#39;</span><span class="token operator">:</span> <span class="token string">&#39;Rome&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>在数组中搜索子对象的多个字段时，如果使用 $elemMatch，它表示必须是同一个</li></ul><p>子对象满足多个条件。考虑以下两个查询：</p><div class="language-js"><pre><code>db<span class="token punctuation">.</span>movies<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token string">&#39;filming_locations.city&#39;</span><span class="token operator">:</span> <span class="token string">&#39;Rome&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;filming_locations.country&#39;</span><span class="token operator">:</span> <span class="token string">&#39;USA&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
db<span class="token punctuation">.</span>movies<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    filming_locations<span class="token operator">:</span> <span class="token punctuation">{</span>
        $elemMatch<span class="token operator">:</span> <span class="token punctuation">{</span> city<span class="token operator">:</span> <span class="token string">&#39;Rome&#39;</span><span class="token punctuation">,</span> country<span class="token operator">:</span> <span class="token string">&#39;USA&#39;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><blockquote><p>控制 find 返回的字段</p><ul><li><p>find 可以指定只返回指定的字段；</p></li><li><p>_id 字段必须明确指明不返回，否则默认返回；</p></li><li><p>在 MongoDB 中我们称这为投影（projection）；</p></li><li><p>db.movies.find({&quot;category&quot;: &quot;action&quot;},{&quot;_id&quot;:0, title:1})； _id 不返回，title 返回</p></li></ul></blockquote><h3 id="删除数据"><a class="header-anchor" href="#删除数据" aria-hidden="true">#</a> 删除数据</h3><ul><li>remove 命令需要配合查询条件使用</li><li>匹配查询条件的文档会被删除</li><li>指定一个文档条件会删除所有记录</li></ul><div class="language-js"><pre><code>db<span class="token punctuation">.</span>fruit<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&#39;apple&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 删除所有name为apple的记录</span>

db<span class="token punctuation">.</span>fruit<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">{</span> weight<span class="token operator">:</span> <span class="token punctuation">{</span> $lt<span class="token operator">:</span> <span class="token number">20</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 删除所有weight小于20的记录</span>

db<span class="token punctuation">.</span>fruit<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 删除所有记录</span>

db<span class="token punctuation">.</span>fruit<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 不会删除任何东西，会报错</span>
</code></pre></div><h3 id="更新数据"><a class="header-anchor" href="#更新数据" aria-hidden="true">#</a> 更新数据</h3><ul><li>Update 操作执行格式：db.&lt;集合&gt;.update(&lt;查询条件&gt;,&lt;更新内容&gt;)</li></ul><p><img src="/docs/assets/1616224528605-0dfde638-032a-4326-bdd4-22cb76d8ff4a.0fe375f1.png" alt="image.png"></p><blockquote><p>Tips:</p><ul><li><p>使用 updateOne 表示无论条件匹配多少条记录，始终只会更新一条</p></li><li><p>使用 updateMany 标识条件匹配多少条就更新多少条</p></li><li><p>updateOne/updateMany 方法要求更新条件部分必须具有以下之一，否则将报错</p></li><li><ul><li>$set/$unset</li><li>$push/$pushAll/$pop</li><li>$pull/$pullAll</li><li>$addToSet</li></ul></li></ul></blockquote><p>$push：增加一个对象到数组最后</p><p>$pushAll：增加多个对象到数组最后</p><p>$pop：从数组的最后删除一个对象</p><p>$pull：如果匹配指定的值，从数组中删除相应的对象</p><p>$pullAll：如果匹配任意的值，从数据中删除相对应的对象</p><p>$addToSet：如果不存在则增加一个值到数组</p><h3 id="删除表"><a class="header-anchor" href="#删除表" aria-hidden="true">#</a> 删除表</h3><ul><li>集合中的所有文档都会被删除</li><li>吉和相关的索引也会被删除</li></ul><div class="language-"><pre><code>db.&lt;集合名&gt;.drop()  // db.fruit.drop()
</code></pre></div><h3 id="删除数据库-dropdatabase"><a class="header-anchor" href="#删除数据库-dropdatabase" aria-hidden="true">#</a> 删除数据库 dropDatabase</h3><ul><li>使用 db.dropDatabase()来删除数据库</li><li>数据库相应的文件也会被删除，磁盘空间将被释放</li></ul><div class="language-"><pre><code>use &lt;db&gt; // 进入要删除的数据库
// 也可以使用 db 命令来查看当前所在数据库
db.dropDatabase() // 删除当前库 这一句命令下去就删除了整个数据库
</code></pre></div><h3 id="备份与恢复"><a class="header-anchor" href="#备份与恢复" aria-hidden="true">#</a> 备份与恢复</h3><ul><li>备份</li></ul><div class="language-"><pre><code>mongodump -h localhost -u &lt;用户名&gt; -p &lt;密码&gt; -d &lt;数据库名&gt; -o &lt;指定目录&gt;
</code></pre></div><blockquote><p>参数说明：</p></blockquote><blockquote><ul><li>-h 指向备份服务器</li><li>-u 用户名</li><li>-p 密码</li><li>-d 指定备份的数据；如果不写这个参数则备份全部数据库</li><li>-o 数据备份到那个目录</li></ul></blockquote><div class="language-"><pre><code>mongorestore -h localhost -u &lt;用户名&gt; -p &lt;密码&gt; --dir &lt;备份文件夹&gt;
</code></pre></div><h2 id="查询"><a class="header-anchor" href="#查询" aria-hidden="true">#</a> 查询</h2><h3 id="聚合查询"><a class="header-anchor" href="#聚合查询" aria-hidden="true">#</a> 聚合查询</h3><h4 id="什么是-mongodb-聚合框架"><a class="header-anchor" href="#什么是-mongodb-聚合框架" aria-hidden="true">#</a> 什么是 MongoDB 聚合框架</h4><blockquote><p>MongoDB 聚合框架（Aggregation Framework）是一个计算框架，它可以：</p><ul><li>作用在一个集合或者几个集合上</li><li>对集合的数据进行的一些列运算</li><li>讲这些数据转化为期望的形式</li></ul></blockquote><p>从效果而言，聚合框架相当于 SQL 查询中的</p><ul><li>GROUP BY</li><li>LEFT OUTER JOIN</li><li>AS 等等</li></ul><h4 id="管道-pipeline-和步骤-stage"><a class="header-anchor" href="#管道-pipeline-和步骤-stage" aria-hidden="true">#</a> 管道(Pipeline)和步骤(Stage)</h4><ul><li><p>整个聚合运算过程成为管道（Pipeline），它由多个步骤组成；每个管道</p></li><li><ul><li>接受一系列文档（原始数据）</li><li>每个步骤对这些文档进行一系列运算</li><li>结果文档输出给下一个步骤</li></ul></li></ul><p><img src="/docs/assets/1616722946746-5f6bcc8c-8fe6-4f06-8803-d48aeef442b8.57e027e9.png" alt="image.png"></p><div class="language-js"><pre><code>pipeline <span class="token operator">=</span> <span class="token punctuation">[</span>$stage1<span class="token punctuation">,</span> $stage2<span class="token punctuation">,</span> <span class="token operator">...</span><span class="token operator">...</span><span class="token punctuation">,</span> $stageN<span class="token punctuation">]</span>

db<span class="token punctuation">.</span><span class="token operator">&lt;</span><span class="token constant">COLLECTION</span><span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">aggregate</span><span class="token punctuation">(</span>pipeline<span class="token punctuation">,</span> <span class="token punctuation">{</span> options <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><table><thead><tr><th>步骤</th><th>作用</th><th>SQL 等价运算符</th></tr></thead><tbody><tr><td>$match</td><td>过滤</td><td>WHERE</td></tr><tr><td>$project</td><td>投影</td><td>AS</td></tr><tr><td>$sort</td><td>排序</td><td>ORDER BY</td></tr><tr><td>$group</td><td>分组</td><td>GROUP BY</td></tr><tr><td>$skip/$limit</td><td>结果限制</td><td>SKIP/LIMIT</td></tr><tr><td>$looup</td><td>左外连接</td><td>LEFT OUTER JOIN</td></tr><tr><td>$unwind</td><td>展开数组</td><td>N/A</td></tr><tr><td>$graphLoopup</td><td>图搜索</td><td>N/A</td></tr><tr><td>$facet/$bucket</td><td>分页搜索</td><td>N/A</td></tr></tbody></table><h3 id="聚合运算的使用场景"><a class="header-anchor" href="#聚合运算的使用场景" aria-hidden="true">#</a> 聚合运算的使用场景</h3><ul><li><p>计算；比如</p></li><li><ul><li>计算一段时间内的销售总额、均值</li><li>分析一段时间的净利润</li><li>分析购买人的年龄分布</li><li>分析学生成绩分布</li><li>统计员工绩效</li><li>.....</li></ul></li><li><p>数据的复杂运用</p></li></ul><h3 id="mql-常用步骤与-sql-对比"><a class="header-anchor" href="#mql-常用步骤与-sql-对比" aria-hidden="true">#</a> MQL 常用步骤与 SQL 对比</h3><p><img src="/docs/assets/1616735835149-4fa69238-f7ea-4c8e-b76f-61dc860d2b5b.c1fa6420.png" alt="image.png"></p><p><img src="/docs/assets/1616735882990-5e0eaa21-3f88-42df-b98e-1b6d74f1a2af.55e858cd.png" alt="image.png"></p><h3 id="mql-特有步骤-unwind"><a class="header-anchor" href="#mql-特有步骤-unwind" aria-hidden="true">#</a> MQL 特有步骤$unwind</h3><p><img src="/docs/assets/1616735977733-fbf68d59-58d5-4e40-b6b0-cccc8af707af.d1d76df9.png" alt="image.png"></p><h3 id="mql-特有的-bucket"><a class="header-anchor" href="#mql-特有的-bucket" aria-hidden="true">#</a> MQL 特有的$bucket</h3><p><img src="/docs/assets/1616736066821-ec321bb0-cec5-4474-b0ea-e0b28c06e862.95340f60.png" alt="image.png"></p><h3 id="mql-特有的-facet"><a class="header-anchor" href="#mql-特有的-facet" aria-hidden="true">#</a> MQL 特有的$facet</h3><p><img src="/docs/assets/1616736149325-a05797b7-521a-494d-b439-fefd0ae0db4a.37bb9e38.png" alt="image.png"></p><h2 id="复制集"><a class="header-anchor" href="#复制集" aria-hidden="true">#</a> 复制集</h2><h3 id="复制集的作用"><a class="header-anchor" href="#复制集的作用" aria-hidden="true">#</a> 复制集的作用</h3><blockquote><ul><li><p>MongoDB 复制集的主要意义在于实现服务高可用</p></li><li><p>它的现实依赖于两个方面的功能</p></li><li><ul><li>数据写入时将数据迅速复制到另一个独立节点上</li><li>在接受写入的节点发生故障是自动选举出一个新的替代节点</li></ul></li><li><p>在实现高可用的同事，复制集实现了其他几个附加作用</p></li><li><ul><li>数据分发：将数据从一个区域复制到另一个区域，减少另一个区域的读延迟</li><li>读写分离：不同类型的压力分别在不同的节点上执行</li><li>异地容灾：在数据中心发生故障的时候快速切换到异地</li></ul></li></ul></blockquote><h3 id="典型复制集结构"><a class="header-anchor" href="#典型复制集结构" aria-hidden="true">#</a> 典型复制集结构</h3><ul><li><p>一个典型的复制集由 3 个以上具有投票权的节点组成，包括：</p></li><li><ul><li>一个节点（PRIMARY）：接受读入操作和选举时投票</li><li>连个（或多个）从节点(SECONDERY)：复制节点上的新数据和选举时投票</li><li>不推荐使用 Arbiter（投票节点）</li></ul></li></ul><p><img src="/docs/assets/1616727985993-8c80b589-0adb-468a-b1b1-e9444e0d9998.63b73eb3.png" alt="image.png"></p><h3 id="数据是如何复制的？"><a class="header-anchor" href="#数据是如何复制的？" aria-hidden="true">#</a> 数据是如何复制的？</h3><ul><li>当一个修改操作，无论是插入、更新或者删除，达到主节点时，它对数据的操作将被记录下来（经过一系列必要的转换），这些记录被称为 oplog</li><li>从节点通过在主节点上打开一个 tailable 游标不断获取新进入直接点的 oplog，并在自己的数据上回放，一次保持跟主节点的数据一致性</li></ul><p><img src="/docs/assets/1616736435076-19160d34-62df-4528-9260-d5e68a4773e6.ffd7ca7c.png" alt="image.png"></p><h3 id="选举时如何完成故障恢复的？"><a class="header-anchor" href="#选举时如何完成故障恢复的？" aria-hidden="true">#</a> 选举时如何完成故障恢复的？</h3><ul><li>具有投票权的节点之间凉凉相互发送心跳</li><li>当 5 次心跳未收到时判断为节点失联（宕机、断网......）</li><li>如果失联的是主节点，从节点会发起选举，选出新的主节点</li><li>如果失恋的是从节点则不会产生新的选举</li><li>选举基于<a href="https://raft.github.io/" target="_blank" rel="noopener noreferrer">RAFT 一致性算法</a>实现，选举成功的必要条件是大多数投票节点存活</li><li>复制集中最多可以有 50 个节点，但具有投票权的节点最多 7 个</li></ul><h3 id="影响选举的因素"><a class="header-anchor" href="#影响选举的因素" aria-hidden="true">#</a> 影响选举的因素</h3><ul><li><p>整个集群必须有大多数节点存活</p></li><li><p>被选举为主节点的节点必须</p></li><li><ul><li>能够与多数节点建立连接</li><li>具有较新的 oplog（操作日志）</li><li>具有较高的优先级（如果有配置）</li></ul></li></ul><h3 id="常见选项"><a class="header-anchor" href="#常见选项" aria-hidden="true">#</a> 常见选项</h3><ul><li><p>复制及节点有以下常见的选置项：</p></li><li><ul><li>是否具有投票权（v 参数）：有则参与投票（默认都有投票权）</li><li>优先级（priority 参数）：优先级越高的节点越优先成为主节点；优先级为 0 的节点无法成为主节点</li><li>隐藏（hidden 参数）：复制数据，但对应不可见；隐藏节点可以具有投票权，但优先级必须为 0</li><li>延迟（slaveDelay）：复制 n 秒之前的数据，保持与主节点的时间差</li></ul></li></ul><p><img src="/docs/assets/1616737227979-ce259f0d-c75f-41ba-ae0e-63b358176af5.c79579b7.png" alt="image.png"></p><h3 id="复制集注意事项"><a class="header-anchor" href="#复制集注意事项" aria-hidden="true">#</a> 复制集注意事项</h3><ul><li><p>关于硬件</p></li><li><ul><li>因为正常的复制集节点都有可能成为主节点，他们的地位是一样的，因此硬件配置上必须一致</li><li>为例保证节点不会同时宕机，各节点使用的硬件必须具有独立性</li></ul></li><li><p>关于软件</p></li><li><ul><li>复制集各节点软件版本必须一致，以避免出现不可预知的问题</li></ul></li><li><p>增加节点不会增加系统写性能</p></li></ul><h3 id="atlas-mongodb-公有云托管服务"><a class="header-anchor" href="#atlas-mongodb-公有云托管服务" aria-hidden="true">#</a> Atlas-MongoDB 公有云托管服务</h3><p><img src="/docs/assets/1616739691929-b7144c9f-c48e-451a-bae6-b9f2bb8e2f11.b44f4070.png" alt="image.png"></p></div></div><footer class="page-footer" data-v-7eddb2c4 data-v-fb8d84c6><div class="edit" data-v-fb8d84c6><div class="edit-link" data-v-fb8d84c6 data-v-1ed99556><!----></div></div><div class="updated" data-v-fb8d84c6><!----></div></footer><!----><!--[--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"index.md\":\"19e27a0d\",\"go_00-起步.md\":\"262b1192\",\"go_01-基础.md\":\"976f482c\",\"go_02-数组与切片.md\":\"07ceb2fc\",\"go_03-流程控制与循环.md\":\"385361e8\",\"go_04-map.md\":\"286128a1\",\"go_05-函数.md\":\"d5c70543\",\"go_06-结构体与方法.md\":\"b8c554c8\",\"go_07-接口.md\":\"1657ccac\",\"go_08-协程与通道.md\":\"8fec717c\",\"go_09-并发资源.md\":\"3c8f4337\",\"go_10-测试.md\":\"b43bf9e9\",\"go_11-反射.md\":\"b7712935\",\"go_12-web开发基础.md\":\"fc15c68e\",\"go_index.md\":\"5dba4824\",\"interview_index.md\":\"47009012\",\"other_01.md\":\"a450434d\",\"other_index.md\":\"aec5d64b\",\"project_index.md\":\"d1dc87f1\",\"database_mongodb_01-mongodb.md\":\"20c42fd4\",\"database_mongodb_index.md\":\"9d1799a0\",\"database_mysql_index.md\":\"80853256\",\"database_redis_index.md\":\"cc1a98e6\",\"front-end_js_base.md\":\"84633a99\",\"front-end_js_index.md\":\"d6fe638b\",\"front-end_nest_01.md\":\"f3553928\",\"front-end_nest_index.md\":\"ba2d6899\",\"front-end_node_1-webpack5-node.md\":\"a4a4fba0\",\"front-end_node_index.md\":\"49a32e96\",\"front-end_react_index.md\":\"530e1e4f\",\"front-end_react-native_01.md\":\"1e75a326\",\"front-end_react-native_02.md\":\"aa73688e\",\"front-end_react-native_03.md\":\"a2fcf196\",\"front-end_react-native_04.md\":\"12d05c23\",\"front-end_react-native_05.md\":\"5cdec945\",\"front-end_react-native_index.md\":\"b71b84bf\",\"front-end_typescript_01-环境准备.md\":\"2ecc2ea9\",\"front-end_typescript_02-为什么要学习typescript.md\":\"d1d57545\",\"front-end_typescript_03-类型全解.md\":\"1bebbd8f\",\"front-end_typescript_04-函数.md\":\"f94772e6\",\"front-end_typescript_index.md\":\"3d9c9cd1\",\"front-end_vue_index.md\":\"64c633f6\",\"front-end_wechat_index.md\":\"85773a46\",\"utils_docker_01-docker.md\":\"8f0bc630\",\"utils_docker_02-docker-compose.md\":\"6a580b73\",\"utils_docker_03-dockerfile.md\":\"f75095a1\",\"utils_docker_04-ci.md\":\"2d523c85\",\"utils_docker_index.md\":\"dd828060\",\"utils_git_01.md\":\"62d28c04\",\"utils_git_02.md\":\"11442eaa\",\"utils_git_03.md\":\"223b301f\",\"utils_git_index.md\":\"76747f8e\"}")</script>
    <script type="module" async src="/docs/assets/app.1507091b.js"></script>
  </body>
</html>